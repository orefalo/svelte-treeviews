var st=Object.defineProperty;var Oe=i=>{throw TypeError(i)};var dt=(i,e,t)=>e in i?st(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var I=(i,e,t)=>dt(i,typeof e!="symbol"?e+"":e,t),lt=(i,e,t)=>e.has(i)||Oe("Cannot "+t);var m=(i,e,t)=>(lt(i,e,"read from private field"),t?t.call(i):e.get(i)),A=(i,e,t)=>e.has(i)?Oe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t);import{d as ot,p as k,r as at,t as J,b as ct,a as O,c as L,s as Re,g as c,e as z,f as me,u as ge,h as B,i as G,j as D,k as Ae,l as ht,m as le,n as ve,o as q,q as be,v as se,w as ye,x as K,y as S,z as b,A as ft,V as ut,B as de,C as Ke,D as gt,E as vt,F as Se,G as yt,H as _t,I as It}from"./external.BYwIfehx.js";ot(["click"]);var mt=L('<input type="checkbox">');function Ut(i,e){let t=k(e,"value",15),n=z(()=>t()===0);var r=mt();at(r),J(()=>{Re(r,e.class),r.indeterminate=c(n)}),ct(r,t),O(i,r)}var bt=L('<div class="vt-tree-line tree-vline"></div>'),xt=L('<div class="vt-tree-line vt-tree-hline"></div>'),kt=L("<!> <!>",1),Nt=L('<div><!> <div class="tree-node-inner"><!></div></div>');function wt(i,e){me(e,!0);let t=k(e,"treeLineStyle",11,"orthogonal"),n=z(()=>e.style?`${e.style};${e.rtl?"padding-right":"padding-left"}:${e.indent*(e.nodeInfo.level-1)}px`:`${e.rtl?"padding-right":"padding-left"}:${e.indent*(e.nodeInfo.level-1)}px`),r=z(()=>`${e.rtl?"right":"left"}:${(e.nodeInfo.level-2)*e.indent+e.treeLineOffset}px`);ge(()=>{var u,f;e.nodeInfo.checked,(u=e.processor)!=null&&u.afterOneCheckChanged(e.nodeInfo)&&((f=e.onNodeChecked)==null||f.call(e,e.nodeInfo))}),ge(()=>{var f,P;e.nodeInfo.expended?(f=e.onNodeOpened)==null||f.call(e,e.nodeInfo):(P=e.onNodeClosed)==null||P.call(e,e.nodeInfo)});const s=z(()=>{const u=[],f=N=>{var w;if(N.parent){let R=(w=N.parent)==null?void 0:w.children.indexOf(N);do{R+=1;const H=N.parent.children[R];if(H){if(!H.hidden)return!0}else break}while(!0)}return!1},P=e.rtl?"right":"left",h=e.btt?"top":"bottom";let y=e.nodeInfo;for(;y;){const N=(y.level-2)*e.indent+e.treeLineOffset,w=f(y),R=()=>{u.push({style:`${P}:${N}px;${h}:${w?"0":"50%"}`})};y===e.nodeInfo?y.level>1&&R():w&&R(),y=y.parent}return u});var o=Nt();const l=z(()=>ye("tree-node",e.class,t()!="none"&&"vt-tree-node--with-tree-line"));var a=B(o);G(a,()=>t()!="none",u=>{var f=kt(),P=D(f);Ae(P,17,()=>c(s),ht,(y,N)=>{var w=bt();J(()=>se(w,"style",c(N).style)),O(y,w)});var h=le(P,2);G(h,()=>e.nodeInfo.level>1&&t()=="orthogonal",y=>{var N=xt();J(()=>se(N,"style",c(r))),O(y,N)}),O(u,f)});var v=le(a,2),_=B(v);ve(_,()=>e.tn_slot,()=>({data:e.nodeInfo.data,info:e.nodeInfo})),q(v),q(o),J(()=>{Re(o,c(l)),se(o,"style",c(n))}),O(i,o),be()}function _e(i){return Object.prototype.toString.call(i)==="[object Array]"}function Ct(i){return i[i.length-1]}function ze(i,e){let t,n=0;for(;(t=i.indexOf(e))>-1;)i.splice(t,1),n++;return n}function Pt(i,e,t){i.hasOwnProperty(e)||(i[e]=t)}function Ot(i,e){return Object.keys(e).forEach(t=>{Pt(i,t,e[t])}),i}function Kt(i){const e={};return Object.keys(i).forEach(t=>{i[t]!==void 0&&(e[t]=i[t])}),e}function M(i,e,t={}){t=Ot({...t},{childrenKey:"children"});const n=t.childrenKey,r=_e(i)?i:[i];class s{}const o=(l,a,v)=>{t.reverse&&(l=l.slice(),l.reverse());const _=l.length;for(let u=0;u<_;u++){const f=l[u],P=t.reverse?_-u-1:u,h=v?[...v,P]:[];t.childFirst&&f[n]!=null&&o(f[n],f,h);const y=e(f,P,a,h);if(y===!1)throw new s;if(y==="skip children")continue;if(y==="skip siblings")break;t.childFirst||f[n]!=null&&o(f[n],f,h)}};try{o(r,null,_e(i)?[]:null)}catch(l){if(!(l instanceof s))throw l}}function St(i,e){const t={childrenKey:"children"};e&&Object.assign(t,e);const n=t.childrenKey,r=t.nodeHandler,s=new Ie;return s.childrenKey=n,M(i,(o,l,a,v)=>{let _=Object.assign({},o);_[n]&&(_[n]=[]),r&&(_=r(_,{oldNode:o,index:l,parent:a,path:v})),s.set(v,_)},{childrenKey:n}),s.data}class Ie{constructor(e=[]){I(this,"data");I(this,"childrenKey","children");this.data=e}get rootChildren(){const{childrenKey:e}=this,{data:t}=this;return _e(t)?t:t[e]}*iteratePath(e,t={}){const{childrenKey:n,rootChildren:r}=this;if(t.reverse){const s=[...this.iteratePath(e,{...t,reverse:!1})];s.reverse();for(const{path:o,node:l}of s)yield{path:o,node:l}}else{let s=[],o=r;for(const l of e){const a=[...s,l],v=o[l];yield{path:a,node:v},s=a,o=v[n]}}}getFamily(e){const t=[];for(const{node:n}of this.iteratePath(e))t.push(n);return t}get(e){return Ct(this.getFamily(e))}getParentAndIndex(e){const t=e.slice(),n=t.pop();return{parent:this.get(t),index:n,parentPath:t}}getParent(e){return this.getParentAndIndex(e).parent}set(e,t){if(e===null||e.length===0)this.data=t;else{const{childrenKey:n}=this;let{rootChildren:r}=this;const{parent:s,index:o}=this.getParentAndIndex(e);let l;e.length===1?(r||(this.data?this.data[n]=[]:this.data=[]),l=r):(s[n]||(s[n]=[]),l=s[n]),l[o]=t}}delete(e){const{childrenKey:t,rootChildren:n}=this,{parent:r,index:s}=this.getParentAndIndex(e),o=e.length===1?n:r[t],l=o[s];return o.splice(s,1),l}walk(e,t){const{childrenKey:n,data:r}=this;return M(r,e,n)}clone(e={}){return St(this.data),Kt({childrenKey:this.childrenKey,nodeHandler:e.nodeHandler||void 0})}}var Q,X,Y,Z,p,$;class j{constructor(e){I(this,"data");A(this,Q,K(!1));I(this,"parent");A(this,X,K(b([])));I(this,"level",0);A(this,Y,K(!1));A(this,Z,K(!1));I(this,"draggable");I(this,"droppable");A(this,p,K(""));A(this,$,K(""));this.data=(e==null?void 0:e.data)||null,this.expended=(e==null?void 0:e.expended)||!1,this.parent=e==null?void 0:e.parent,this.children=(e==null?void 0:e.children)||[],this.level=(e==null?void 0:e.level)||0,this.hidden=(e==null?void 0:e.hidden)||!1,this.checked=(e==null?void 0:e.checked)||!1,this.draggable=e==null?void 0:e.draggable,this.droppable=e==null?void 0:e.droppable,this.style=e==null?void 0:e.style,this.class=e==null?void 0:e.class}get expended(){return c(m(this,Q))}set expended(e){S(m(this,Q),b(e))}get children(){return c(m(this,X))}set children(e){S(m(this,X),b(e))}get hidden(){return c(m(this,Y))}set hidden(e){S(m(this,Y),b(e))}get checked(){return c(m(this,Z))}set checked(e){S(m(this,Z),b(e))}get style(){return c(m(this,p))}set style(e){S(m(this,p),b(e))}get class(){return c(m(this,$))}set class(e){S(m(this,$),b(e))}toggleExpand(){this.expended=!this.expended}toggleChecked(){this.checked=!this.checked}}Q=new WeakMap,X=new WeakMap,Y=new WeakMap,Z=new WeakMap,p=new WeakMap,$=new WeakMap;const E="children";class Le{constructor(e){I(this,"childrenKey",E);I(this,"defaultOpen",!1);I(this,"noInitialization",!1);this.childrenKey=(e==null?void 0:e.childrenKey)||E,this.defaultOpen=(e==null?void 0:e.defaultOpen)||!1,this.noInitialization=(e==null?void 0:e.noInitialization)||!1}}var ee,te,ne;class Tt{constructor(e,t){I(this,"rawData");A(this,ee,K(b([])));A(this,te,K(b([])));A(this,ne,K(b(new Map)));I(this,"options");I(this,"afterSetInfoNode");I(this,"afterRemoveInfoNode");I(this,"infoNodesHandler");I(this,"infoNodesFlatHandler");I(this,"infoHandler",e=>e);I(this,"initialized",!1);this.options=t||new Le}get nodeInfos(){return c(m(this,ee))}set nodeInfos(e){S(m(this,ee),b(e))}get nodeInfosToRender(){return c(m(this,te))}set nodeInfosToRender(e){S(m(this,te),b(e))}get _infosMap(){return c(m(this,ne))}set _infosMap(e){S(m(this,ne),b(e))}init(){if(!this.initialized){this.initialized=!0,console.log("TreeProcessor.init() called");const e=this.options.childrenKey,t=new Ie([]);this._infosMap.clear(),M(this.rawData,(r,s,o,l)=>{const a=this.infoHandler(new j({data:r,expended:this.options.defaultOpen,parent:t.getParent(l),children:[],level:l.length}));this._infosMap.set(r,a),t.set(l,a)},{childrenKey:e});const n=[];t.walk(r=>{n.push(r)}),this.nodeInfos=this.infoNodesHandler?this.infoNodesHandler(t.rootChildren):t.rootChildren,this.nodeInfosToRender=this.infoNodesFlatHandler?this.infoNodesFlatHandler(n):n}}getNodeInfo(e){const t=this._infosMap.get(e);if(!t)throw new Te("NodeInfo not found");return t}has(e){if(e instanceof j)return this.nodeInfosToRender.indexOf(e)>-1;try{return(!!this.getNodeInfo(e)).valueOf()}catch(t){if(t instanceof Te)return!1;throw t}}_getPathByStat(e){if(e===null)return[];const n=this.getSiblings(e).indexOf(e);return[...e.parent?this._getPathByStat(e.parent):[],n]}afterOneCheckChanged(e){const{checked:t}=e,n=r=>{const s=r.parent;if(s){let o=!1,l=!1,a=!1;for(const _ of s.children)_.checked?o=!0:_.checked===0?a=!0:l=!0;const v=a?0:l?o?0:!1:!0;s.checked!==v&&(s.checked=v),n(s)}};return n(e),M(e.children,r=>{r.checked!==t&&(r.checked=t)},{childrenKey:E}),!0}isVisible(e){const t=e instanceof j?e:this.getNodeInfo(e),n=r=>!r||!r.hidden&&r.expended&&n(r.parent);return!t.hidden&&n(t.parent)}updateCheckboxes(){M(this.nodeInfos,e=>{if(e.children&&e.children.length>0){const t=e.children.every(n=>n.checked);e.checked!==t&&(e.checked=t)}},{childFirst:!0,childrenKey:E})}getChecked(e=!1){return this.nodeInfosToRender.filter(t=>t.checked||e&&t.checked===0)}getUnchecked(e=!0){return this.nodeInfosToRender.filter(t=>e?!t.checked:t.checked===!1)}openAll(){for(const e of this.nodeInfosToRender)e.expended=!0}closeAll(){for(const e of this.nodeInfosToRender)e.expended=!1}openNodeAndParents(e){const t=e instanceof j?e:this.getNodeInfo(e);for(const n of this.iterateParent(t,{withSelf:!0}))n.expended=!0}_calcFlatIndex(e,t){let n=e?this.nodeInfosToRender.indexOf(e)+1:0;const r=e?e.children:this.nodeInfos;for(let s=0;s<t;(s+=1)-1)n+=this._count(r[s]);return n}add(e,t,n){if(this.has(e))throw"Can't add because data exists in tree";const r=t?t.children:this.nodeInfos;n==null&&(n=r.length);const s=this.infoHandler(new j({expended:!!this.options.defaultOpen,data:e,parent:t||void 0,children:[],level:t?t.level+1:1}));this._setPosition(s,t||void 0,n);const o=e[this.childrenKey];if(o){const l=o.slice();for(const a of l)this.add(a,s)}}remove(e){var n;const t=this.getSiblings(e);if(t.includes(e)){ze(t,e);const r=this._flat(e);this.nodeInfosToRender.splice(this.nodeInfosToRender.indexOf(e),r.length);for(const s of r)this._infosMap.delete(s.data);return(n=this.afterRemoveInfoNode)==null||n.call(this,e),!0}return!1}getSiblings(e){const{parent:t}=e;return t?t.children:this.nodeInfos}_setPosition(e,t,n){var l;(t?t.children:this.nodeInfos).splice(n,0,e),e.parent=t,e.level=t?t.level+1:1;const s=this._calcFlatIndex(t,n),o=this._flat(e);this.nodeInfosToRender.splice(s,0,...o);for(const a of o)this._infosMap.has(a.data)||this._infosMap.set(a.data,a);M(e,(a,v,_)=>{_&&(a.level=_.level+1)},{childrenKey:E}),(l=this.afterSetInfoNode)==null||l.call(this,e,t,n)}*iterateParent(e,t){let n=t!=null&&t.withSelf?e:e.parent;for(;n;)yield n,n=n.parent}move(e,t,n){if(this.has(e)){if(e.parent===t&&this.getSiblings(e).indexOf(e)===n)return!1;if(e===t)throw new Error("Can't move node to itself");if(t&&e.level<t.level){let r;for(const s of this.iterateParent(t))if(s.level===e.level){r=s;break}if(e===r)throw new Error("Can't move node to its descendant")}this.remove(e)}return this._setPosition(e,t,n),!0}_flat(e){const t=[];return M(e,n=>{t.push(n)},{childrenKey:E}),t}_count(e){return this._flat(e).length}getData(e,t){const{childrenKey:n}=this.options,r=new Ie([]);return r.childrenKey=n,M(t||this.nodeInfos,(s,o,l,a)=>{let v={...s.data,[n]:[]};e&&(v=e(v)),r.set(a,v)},{childrenKey:E}),r.data}}ee=new WeakMap,te=new WeakMap,ne=new WeakMap;class Te extends Error{constructor(e){super(e),this.name="StatNotFoundError"}}class Rt extends Le{constructor(t){super(t);I(this,"preProcessor")}filter(t,n){return t?t(n):n}}function At(i,e){const t=new Rt(e),n=new Tt(i,t);return t.noInitialization||n.init(),n}var zt=L('<div class="drag-placeholder vt-tree-drag-placeholder"><!></div>');function Bt(i,e){me(e,!0);let t=k(e,"updateBehavior",3,"modify"),n=k(e,"childrenKey",3,E),r=k(e,"indent",15,20),s=k(e,"virtualization",11,!1),o=k(e,"virtualizationPrerenderCount",3,20),l=k(e,"defaultOpen",11,!0),a=k(e,"rtl",15,!1),v=k(e,"btt",15,!1),_=k(e,"treeLineStyle",15,"none"),u=k(e,"treeLineOffset",15,8),f=k(e,"class",3,""),P=k(e,"style",3,"");k(e,"selectionBehavior",3,"single");let h=k(e,"processor",23,()=>At([],{noInitialization:!0,defaultOpen:l()}));const y=d=>d?(d[n()]||(d[n()]=[]),d[n()]):c(W);h().afterSetInfoNode=(d,g,x)=>{let C=c(W);if(t()==="new"){if(F)return;C=re()}else if(t()==="modify"){const V=y(g==null?void 0:g.data);V.includes(d.data)||V.splice(x,0,d.data)}else t();F||ce(C)},h().afterRemoveInfoNode=d=>{var x;let g=c(W);if(t()==="new"){if(F)return;g=re()}else if(t()==="modify"){const C=y((x=d.parent)==null?void 0:x.data);ze(C,d.data)}else t();F||ce(g)};let N,w=K(b([])),R=K(b([])),H=null,oe=!1,ie={},F=!1,ae=!1,W=z(()=>e.model);ge(()=>{ae?ae=!1:(h().rawData=e.model,h().init(),S(w,b(h().nodeInfos)),S(R,b(h().nodeInfosToRender)))});function Fe(d){}function Me(){let d=c(R);return v()&&(d=d.slice().reverse()),d.filter(g=>ke(g))}function Ee(){return c(w)}function Ve(d){e.onUpdateValue&&e.onUpdateValue(d)}function ce(d){return t()==="disabled"?!1:(d!==c(W)&&(ae=!0),Ve(d),!0)}function xe(d){return h().getNodeInfo(d)}function De(d){return h().has(d)}function Ue(d){return h().getChecked(d)}function Be(d){return h().getUnchecked(d)}function qe(){console.log("openAll"),h().openAll()}function Ge(d){h().openNodeAndParents(d)}function We(){console.log("closeAll"),h().closeAll()}function ke(d){return h().isVisible(d)}function je(d,g,x){return h().move(d,g,x)}function Ne(d,g,x){return h().add(d,g,x)}function Je(d,g,x){he(()=>{let C=x;for(const V of d)Ne(V,g,C),C!=null&&(C+=1)})}function we(d){return h().remove(d)}function Qe(d){const g=[...d];he(()=>{for(const x of g)we(xe(x))})}function Xe(d,g){return h().iterateParent(d,g)}function Ye(d){return h().getSiblings(d)}function re(d,g){return h().getData(d,g)}function he(d){const g=Ze(d);return F||ce(t()==="new"?re():c(W)),g}function Ze(d){const g=F;F=!0;const x=d();return F=g,x}var pe=z(()=>ye("vt-tree",f(),a()&&"vt-tree--rtl",oe)),$e=z(()=>!s()),et=z(Me);return ft(ut(i,{get class(){return c(pe)},get style(){return P()},get preRenderCount(){return o()},get isDisabled(){return c($e)},get items(){return c(et)},vl_slot:(g,x)=>{let C=()=>x==null?void 0:x().item;var V=de(),tt=D(V);G(tt,C,nt=>{var it=z(()=>ye(C().class,{"drag-placeholder-wrapper":C().data===ie,"dragging-node":C()===H}));wt(nt,{get class(){return c(it)},get style(){return C().style},get nodeInfo(){return C()},get rtl(){return a()},set rtl(T){a(T)},get btt(){return v()},set btt(T){v(T)},get indent(){return r()},set indent(T){r(T)},get treeLineStyle(){return _()},set treeLineStyle(T){_(T)},get treeLineOffset(){return u()},set treeLineOffset(T){u(T)},get processor(){return h()},get onNodeOpened(){return e.onNodeOpened},get onNodeClosed(){return e.onNodeClosed},onNodeChecked:Fe,tn_slot:(T,Ce=Ke)=>{var Pe=de(),rt=D(Pe);G(rt,()=>Ce().data===ie,fe=>{var U=zt(),ue=B(U);ve(ue,()=>e.placeholder??Ke),q(U),O(fe,U)},fe=>{var U=de(),ue=D(U);ve(ue,()=>e.tree_slot,Ce),O(fe,U)}),O(T,Pe)},$$slots:{tn_slot:!0}})}),O(g,V)},$$slots:{vl_slot:!0}}),g=>N=g,()=>N),be({rootChildren:Ee,getNodeInfo:xe,has:De,getChecked:Ue,getUnchecked:Be,openAll:qe,openNodeAndParents:Ge,closeAll:We,isVisible:ke,move:je,add:Ne,addMulti:Je,remove:we,removeMulti:Qe,iterateParent:Xe,getSiblings:Ye,getData:re,batchUpdate:he})}var Lt=L('<div class="item svelte-1s0qzrn"><!></div>'),Ht=L('<section class="svelte-1s0qzrn"><!></section>'),Ft=L("<b> </b> <!>",1);function He(i,e){me(e,!0);let t=k(e,"tree",15),n=k(e,"node",7);const r=300;function s(u){n().children=u.detail.items}function o(u){n().children=u.detail.items,t({...t()})}var l=Ft(),a=D(l),v=B(a,!0);q(a);var _=le(a,2);G(_,()=>{var u;return(u=n())==null?void 0:u.children},u=>{var f=Ht(),P=B(f);G(P,()=>n().children,h=>{var y=de(),N=D(y);Ae(N,25,()=>n().children,w=>w.id,(w,R)=>{var H=Lt(),oe=B(H);He(oe,{get tree(){return t()},set tree(ie){t(ie)},get node(){return t()[c(R).id]}}),q(H),gt(H,()=>yt,()=>({duration:r})),O(w,H)}),O(h,y)}),q(f),vt(f,(h,y)=>_t(h,y),()=>({items:n().children||[],flipDurationMs:r,centreDraggedOnCursor:!0})),Se("consider",f,s),Se("finalize",f,o),O(u,f)}),J(()=>{var u,f;se(a,"style",`color:${((u=n())==null?void 0:u.color)??""}`),It(v,(f=n())==null?void 0:f.name)}),O(i,l),be()}var Mt=L("<h3>Try dragging node2 into node3 and then node4 into node2</h3> <!>",1);function qt(i){let e=K(b({node1:{name:"node 1",children:[{id:"node2"},{id:"node3"},{id:"node4"}],id:"node1"},node2:{name:"node 2",children:[{id:"node5"},{id:"node6"},{id:"node7"},{id:"node8"}],id:"node2"},node3:{name:"node 3",children:[{id:"node9"},{id:"node10"},{id:"node11"},{id:"node12"}],id:"node3"},node4:{name:"node 4",children:[{id:"node13"},{id:"node14"},{id:"node15"},{id:"node16"}],id:"node4",color:"salmon"}}));function t(){for(let s=5;s<17;(s+=1)-1)c(e)[`node${s}`]={id:`node${s}`,name:`item ${s}`};c(e).node10.color="steelblue",c(e).node11.color="steelblue",c(e).node14.color="orange",c(e).node15.color="orange",c(e).node6.color="forestgreen"}t();var n=Mt(),r=le(D(n),2);He(r,{get node(){return c(e).node1},get tree(){return c(e)},set tree(s){S(e,b(s))}}),O(i,n)}export{qt as A,Ut as I,Bt as T};
