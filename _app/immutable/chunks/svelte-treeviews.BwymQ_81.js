var Be=Object.defineProperty;var we=i=>{throw TypeError(i)};var je=(i,e,t)=>e in i?Be(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var v=(i,e,t)=>je(i,typeof e!="symbol"?e+"":e,t),Qe=(i,e,t)=>e.has(i)||we("Cannot "+t);var ee=(i,e,t)=>(Qe(i,e,"read from private field"),t?t.call(i):e.get(i)),Ie=(i,e,t)=>e.has(i)?we("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t);import{d as Ze,p as ze,a as I,s as j,b,u as re,o as qe,c as Je,g as c,e as D,f as Ne,i as Q,t as le,h as T,j as ye,k as Z,l as ae,m as V,n as M,q as Se,r as p,v as _e,w as $,x as De,y as de,z as te,A as be,B as J,C as We,D as Ye,E as Xe,F as Re,G as Ge,H as pe,I as $e}from"./external.iPVOiwnK.js";Ze(["click"]);class et{constructor(e,t,n,s){v(this,"model");v(this,"modelCount");v(this,"itemSize");v(this,"estimatedItemSize");v(this,"itemSizeAndPositionData");v(this,"lastMeasuredIndex");v(this,"totalSize");this.model=e,this.itemSize=n,this.modelCount=t,this.estimatedItemSize=s,this.itemSizeAndPositionData=[],this.lastMeasuredIndex=-1,this.checkForMismatchItemSizeAndItemCount(),this.justInTime||this.computeTotalSizeAndPositionData()}get justInTime(){return typeof this.itemSize=="function"}updateConfig(e,t,n){t!==void 0&&(this.modelCount=t),n!==void 0&&(this.estimatedItemSize=n),e!==void 0&&(this.itemSize=e),this.checkForMismatchItemSizeAndItemCount(),this.justInTime&&this.totalSize!==void 0?this.totalSize=void 0:this.computeTotalSizeAndPositionData()}checkForMismatchItemSizeAndItemCount(){if(Array.isArray(this.itemSize)&&this.itemSize.length<this.modelCount)throw Error("When itemSize is an array, itemSize.length can't be smaller than itemCount")}getSize(e){const{itemSize:t}=this;return typeof t=="function"?this.model?t(this.model[e],e):0:Array.isArray(t)?t[e]:t}computeTotalSizeAndPositionData(){let e=0;for(let t=0;t<this.modelCount;t++){const n=this.getSize(t),s=e;e+=n,this.itemSizeAndPositionData[t]={offset:s,size:n}}this.totalSize=e}getLastMeasuredIndex(){return this.lastMeasuredIndex}getSizeAndPositionForIndex(e){return e<0||e>=this.modelCount?{size:0,offset:0}:this.justInTime?this.getJustInTimeSizeAndPositionForIndex(e):this.itemSizeAndPositionData[e]}getJustInTimeSizeAndPositionForIndex(e){if(e>this.lastMeasuredIndex){const t=this.getSizeAndPositionOfLastMeasuredItem();let n=t.offset+t.size;for(let s=this.lastMeasuredIndex+1;s<=e;s++){const l=this.getSize(s);if(l===void 0||isNaN(l))throw Error(`Invalid size returned for index ${s} of value ${l}`);this.itemSizeAndPositionData[s]={offset:n,size:l},n+=l}this.lastMeasuredIndex=e}return this.itemSizeAndPositionData[e]}getSizeAndPositionOfLastMeasuredItem(){return this.lastMeasuredIndex>=0?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}}getEstimatedItemSize(){return this.estimatedItemSize||typeof this.itemSize=="number"&&this.itemSize||50}getTotalSize(){if(this.totalSize)return this.totalSize;const e=this.getSizeAndPositionOfLastMeasuredItem();return e.offset+e.size+(this.modelCount-this.lastMeasuredIndex-1)*this.getEstimatedItemSize()}getUpdatedOffsetForIndex(e=oe.START,t,n,s){if(t<=0)return 0;const l=this.getSizeAndPositionForIndex(s),o=l.offset,r=o-t+l.size;let a;switch(e){case oe.END:a=r;break;case oe.CENTER:a=o-(t-l.size)/2;break;case oe.START:a=o;break;default:a=Math.max(r,Math.min(o,n))}const f=this.getTotalSize();return Math.max(0,Math.min(f-t,a))}getVisibleRange(e=0,t,n){if(this.getTotalSize()===0)return{start:0,end:0};const l=t+e;let o=this.findNearestItem(t);if(o===void 0)throw Error(`Invalid offset ${t} specified`);const r=this.getSizeAndPositionForIndex(o);t=r.offset+r.size;let a=o;for(;t<l&&a<this.modelCount-1;)a++,t+=this.getSizeAndPositionForIndex(a).size;return n&&(o=Math.max(0,o-n),a=Math.min(a+n,this.modelCount-1)),{start:o,end:a}}resetItem(e){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,e-1)}findNearestItem(e){if(isNaN(e))throw Error(`Invalid offset ${e} specified`);e=Math.max(0,e);const t=this.getSizeAndPositionOfLastMeasuredItem(),n=Math.max(0,this.lastMeasuredIndex);return t.offset>=e?this.binarySearch(0,n,e):this.exponentialSearch(n,e)}binarySearch(e,t,n){let s=0,l=0;for(;e<=t;){if(s=e+Math.floor((t-e)/2),l=this.getSizeAndPositionForIndex(s).offset,l===n)return s;l<n?e=s+1:l>n&&(t=s-1)}return e>0?e-1:0}exponentialSearch(e,t){let n=1;for(;e<this.modelCount&&this.getSizeAndPositionForIndex(e).offset<t;)e+=n,n*=2;return this.binarySearch(Math.floor(e/2),Math.min(e,this.modelCount-1),t)}}const tt=(()=>{let i=!1;try{const e=Object.defineProperty({},"passive",{get(){return i={passive:!0},!0}});window.addEventListener("testpassive",e,e),window.remove("testpassive",e,e)}catch{}return i})();var nt=Z('<div><!> <div class="virtual-list-inner svelte-f32i87"><!></div> <!></div>');function it(i,e){ze(e,!0);const t=I(e,"width",3,"100%"),n=I(e,"model",19,()=>[]),s=I(e,"windowOverPadding",3,3),l=I(e,"scrollDirection",19,()=>K.VERTICAL),o=I(e,"scrollToAlignment",19,()=>oe.AUTO),r=I(e,"scrollToBehaviour",19,()=>Me.INSTANT),a=I(e,"class",3,"");I(e,"style",3,"");const f={[K.VERTICAL]:"top",[K.HORIZONTAL]:"left"},A={[K.VERTICAL]:"scrollTop",[K.HORIZONTAL]:"scrollLeft"},g=new et(n(),e.modelCount,e.itemSize,e.estimatedItemSize);let m=!1,C,N=j(b([])),y=j(b({offset:e.scrollOffset||e.scrollToIndex!==void 0&&e.modelCount&&ne(e.scrollToIndex)||0,scrollChangeReason:se.REQUESTED})),P={},z={scrollToIndex:e.scrollToIndex,scrollToAlignment:o(),scrollOffset:e.scrollOffset,modelCount:e.modelCount,itemSize:e.itemSize,estimatedItemSize:e.estimatedItemSize},k={},w=j(""),x=j("");re(()=>{e.scrollToIndex,o(),e.scrollOffset,e.modelCount,e.itemSize,e.estimatedItemSize,_()}),re(()=>{c(y),L()}),re(()=>{e.height,t(),m&&ce(0)}),(()=>{if(l()===K.VERTICAL&&typeof e.height!="number")throw new Error("virtual list's height must be a number when scrollDirection is 'vertical', got "+e.height);if(l()===K.HORIZONTAL&&typeof t()!="number")throw new Error("virtual list's width must be a number if scrollDirection is 'horizontal', got "+t());F()})(),qe(()=>{C.addEventListener("scroll",me,tt),e.scrollOffset!==void 0?q(e.scrollOffset):e.scrollToIndex!==void 0&&q(ne(e.scrollToIndex)),m=!0}),Je(()=>{m&&C.removeEventListener("scroll",me)});function _(){if(!m)return;e.scrollToIndex&&e.scrollOffset&&console.log("VirtualList: scrollToIndex and scrollOffset shall not be used together.");const d=z.scrollToIndex!==e.scrollToIndex||z.scrollToAlignment!==o(),h=z.modelCount!==e.modelCount||z.itemSize!==e.itemSize||z.estimatedItemSize!==e.estimatedItemSize;h&&(g.updateConfig(e.itemSize,e.modelCount,e.estimatedItemSize),ce()),z.scrollOffset!==e.scrollOffset?D(y,b({offset:e.scrollOffset||0,scrollChangeReason:se.REQUESTED})):typeof e.scrollToIndex=="number"&&(d||h)&&D(y,b({offset:ne(e.scrollToIndex,o(),e.modelCount),scrollChangeReason:se.REQUESTED})),z={scrollToIndex:e.scrollToIndex,scrollToAlignment:o(),scrollOffset:e.scrollOffset,modelCount:e.modelCount,itemSize:e.itemSize,estimatedItemSize:e.estimatedItemSize}}function L(){if(!m)return;const{offset:d,scrollChangeReason:h}=c(y);(P.offset!==d||P.scrollChangeReason!==h)&&F(),P.offset!==d&&h===se.REQUESTED&&q(d),P=c(y)}function F(){if(n().length===0||e.isDisabled)return;const{offset:d}=c(y);let{start:h,end:O}=g.getVisibleRange(l()===K.VERTICAL?e.height:t(),d,s()),U=[];const B=g.getTotalSize(),Y=typeof e.height=="number"?"px":"",R=typeof t()=="number"?"px":"";if(l()===K.VERTICAL?(D(w,`height:${e.height}${Y};width:${t()}${R};`),D(x,`flex-direction:column;height:${B}px;`)):(D(w,`height:${e.height}${Y};width:${t()}${R};`),D(x,`min-height:100%;width:${B}px;`)),n()&&h!==void 0&&O!==void 0){for(let S=h;S<=O;(S+=1)-1)U.push({item:n()[S],index:S,style:xe(S)});if(e.onVisibleRangeUpdate){const S=g.getVisibleRange(l()===K.VERTICAL?e.height:t(),d,0);e.onVisibleRangeUpdate({type:"range.update",start:S.start,end:S.end})}}D(N,b(U))}function q(d){"scroll"in C?C.scroll({[f[l()]]:d,behavior:r()}):C[A[l()]]=d}function ce(d=0){k={},g.resetItem(d),F()}function ne(d,h=o(),O=e.modelCount){return d<0?d=0:d>=O&&(d=O-1),g.getUpdatedOffsetForIndex(h,l()===K.VERTICAL?e.height:t(),c(y).offset||0,d)}const me=d=>{const h=C[A[l()]];h<0||c(y).offset===h||d.target!==C||(D(y,b({offset:h,scrollChangeReason:se.OBSERVED})),e.onAfterScroll&&e.onAfterScroll({type:"scroll.update",offset:h,event:d}))};function xe(d){if(k[d])return k[d];const{size:h,offset:O}=g.getSizeAndPositionForIndex(d),U=l()===K.VERTICAL?`left:0;width:100%;height:${h}px;position:absolute;top:${O}px;`:`top:0;width:${h}px;position:absolute;height:100%;left:${O}px;`;return k[d]=U}var W=nt();Ne(W,d=>C=d,()=>C);var ve=p(W);Q(ve,()=>e.header,d=>{var h=V(),O=M(h);te(O,()=>e.header),T(d,h)});var u=ae(ve,2),E=p(u);Q(E,()=>e.isDisabled,d=>{var h=V(),O=M(h);Se(O,17,n,_e,(U,B,Y)=>{var R=V(),S=M(R);te(S,()=>e.vl_slot,()=>({item:c(B),style:"",index:Y})),T(U,R)}),T(d,h)},d=>{var h=V(),O=M(h);Se(O,17,()=>c(N),_e,(U,B)=>{var Y=V(),R=M(Y);te(R,()=>e.vl_slot,()=>({item:c(B).item,style:c(B).style,index:c(B).index})),T(U,Y)}),T(d,h)}),$(u);var H=ae(u,2);return Q(H,()=>e.footer,d=>{var h=V(),O=M(h);te(O,()=>e.footer),T(d,h)}),$(W),le(()=>{De(W,`virtual-list-wrapper $${a()??""} svelte-f32i87`),de(W,"style",c(w)),de(u,"style",c(x))}),T(i,W),ye({recomputeSizes:ce})}var Me=(i=>(i.AUTO="auto",i.SMOOTH="smooth",i.INSTANT="instant",i))(Me||{}),oe=(i=>(i.AUTO="auto",i.START="start",i.CENTER="center",i.END="end",i))(oe||{}),K=(i=>(i.HORIZONTAL="horizontal",i.VERTICAL="vertical",i))(K||{}),se=(i=>(i[i.OBSERVED=0]="OBSERVED",i[i.REQUESTED=1]="REQUESTED",i))(se||{}),st=Z('<div class="tree-line tree-vline svelte-gfld7i"></div>'),lt=Z('<div class="tree-line tree-hline svelte-gfld7i"></div>'),ot=Z("<!> <!>",1),rt=Z('<div><!> <div class="tree-node-inner"><!></div></div>');function dt(i,e){ze(e,!0);let t=I(e,"rtl",3,!1),n=I(e,"btt",3,!1),s=I(e,"indent",3,20),l=I(e,"treeLine",3,!0),o=I(e,"treeLineOffset",3,10),r=J(()=>`${t()?"paddingRight":"paddingLeft"}:${s()*(e.nodeInfo.level-1)}px`),a=J(()=>`${t()?"right":"left"}:${(e.nodeInfo.level-2)*s()+o()}px`);re(()=>{var P,z;e.nodeInfo.checked,!f&&(P=e.processor)!=null&&P.afterOneCheckChanged(e.nodeInfo)&&((z=e.onNodeChecked)==null||z.call(e,e.nodeInfo))}),re(()=>{var z,k;const P=e.nodeInfo.expended;console.log("toggleOpen"),!f&&(P?(z=e.onNodeOpened)==null||z.call(e,e.nodeInfo):(k=e.onNodeClosed)==null||k.call(e,e.nodeInfo),A())});let f=!1;const A=()=>{f=!0,setTimeout(()=>{f=!1},100)},g=J(()=>{const P=[],z=_=>{var L;if(_.parent){let F=(L=_.parent)==null?void 0:L.children.indexOf(_);do{F+=1;const q=_.parent.children[F];if(q){if(!q.hidden)return!0}else break}while(!0)}return!1},k=t()?"right":"left",w=n()?"top":"bottom";let x=e.nodeInfo;for(;x;){const _=(x.level-2)*s()+o(),L=z(x),F=()=>{P.push({style:`${k}:${_}px;${w}:${L?"0":"50%"}`})};x===e.nodeInfo?x.level>1&&F():L&&F(),x=x.parent}return P});var m=rt();le(()=>De(m,`${be("tree-node",e.class,l()&&"tree-node--with-tree-line")??""} svelte-gfld7i`));var C=p(m);Q(C,l,P=>{var z=ot(),k=M(z);Se(k,17,()=>c(g),_e,(x,_)=>{var L=st();le(()=>de(L,"style",c(_).style)),T(x,L)});var w=ae(k,2);Q(w,()=>e.nodeInfo.level>1,x=>{var _=lt();le(()=>de(_,"style",c(a))),T(x,_)}),T(P,z)});var N=ae(C,2),y=p(N);te(y,()=>e.tn_slot,()=>({data:e.nodeInfo.nodeData,info:e.nodeInfo})),$(N),$(m),le(()=>de(m,"style",`${e.style} ${c(r)}`)),T(i,m),ye()}function Oe(i){return Object.prototype.toString.call(i)==="[object Array]"}function at(i){return i[i.length-1]}function Ke(i,e){let t,n=0;for(;(t=i.indexOf(e))>-1;)i.splice(t,1),n++;return n}function ct(i,e,t){i.hasOwnProperty(e)||(i[e]=t)}function ht(i,e){return Object.keys(e).forEach(t=>{ct(i,t,e[t])}),i}function ft(i){const e={};return Object.keys(i).forEach(t=>{i[t]!==void 0&&(e[t]=i[t])}),e}function X(i,e,t={}){t=ht({...t},{childrenKey:"children"});const n=t.childrenKey,s=Oe(i)?i:[i];class l{}const o=(r,a,f)=>{t.reverse&&(r=r.slice(),r.reverse());const A=r.length;for(let g=0;g<A;g++){const m=r[g],C=t.reverse?A-g-1:g,N=f?[...f,C]:[];t.childFirst&&m[n]!=null&&o(m[n],m,N);const y=e(m,C,a,N);if(y===!1)throw new l;if(y==="skip children")continue;if(y==="skip siblings")break;t.childFirst||m[n]!=null&&o(m[n],m,N)}};try{o(s,null,Oe(i)?[]:null)}catch(r){if(!(r instanceof l))throw r}}function ut(i,e){const t={childrenKey:"children"};e&&Object.assign(t,e);const n=t.childrenKey,s=t.nodeHandler,l=new Ae;return l.childrenKey=n,X(i,(o,r,a,f)=>{let A=Object.assign({},o);A[n]&&(A[n]=[]),s&&(A=s(A,{oldNode:o,index:r,parent:a,path:f})),l.set(f,A)},{childrenKey:n}),l.data}class Ae{constructor(e=[]){v(this,"data");v(this,"childrenKey","children");this.data=e}get rootChildren(){const{childrenKey:e}=this,{data:t}=this;return Oe(t)?t:t[e]}*iteratePath(e,t={}){const{childrenKey:n,rootChildren:s}=this;if(t.reverse){const l=[...this.iteratePath(e,{...t,reverse:!1})];l.reverse();for(const{path:o,node:r}of l)yield{path:o,node:r}}else{let l=[],o=s;for(const r of e){const a=[...l,r],f=o[r];yield{path:a,node:f},l=a,o=f[n]}}}getFamily(e){const t=[];for(const{node:n}of this.iteratePath(e))t.push(n);return t}get(e){return at(this.getFamily(e))}getParentAndIndex(e){const t=e.slice(),n=t.pop();return{parent:this.get(t),index:n,parentPath:t}}getParent(e){return this.getParentAndIndex(e).parent}set(e,t){if(e===null||e.length===0)this.data=t;else{const{childrenKey:n}=this;let{rootChildren:s}=this;const{parent:l,index:o}=this.getParentAndIndex(e);let r;e.length===1?(s||(this.data?this.data[n]=[]:this.data=[]),r=s):(l[n]||(l[n]=[]),r=l[n]),r[o]=t}}delete(e){const{childrenKey:t,rootChildren:n}=this,{parent:s,index:l}=this.getParentAndIndex(e),o=e.length===1?n:s[t],r=o[l];return o.splice(l,1),r}walk(e,t){const{childrenKey:n,data:s}=this;return X(s,e,n)}clone(e={}){return ut(this.data),ft({childrenKey:this.childrenKey,nodeHandler:e.nodeHandler||void 0})}}class he{constructor(e){v(this,"nodeData");v(this,"expended");v(this,"parent");v(this,"children");v(this,"level");v(this,"hidden");v(this,"checked");v(this,"draggable");v(this,"droppable");v(this,"style");v(this,"class");v(this,"_ignoreCheckedOnce");this.nodeData=(e==null?void 0:e.nodeData)||null,this.expended=(e==null?void 0:e.expended)||!1,this.parent=(e==null?void 0:e.parent)||null,this.children=(e==null?void 0:e.children)||[],this.level=(e==null?void 0:e.level)||0,this.hidden=(e==null?void 0:e.hidden)||!1,this.checked=(e==null?void 0:e.checked)||!1,this.draggable=(e==null?void 0:e.draggable)||null,this.droppable=(e==null?void 0:e.droppable)||null,this.style=e==null?void 0:e.style,this.class=e==null?void 0:e.class,this._ignoreCheckedOnce=e==null?void 0:e._ignoreCheckedOnce}toggleExpand(){console.log("nodeInfo.toggleExpand"),this.expended=!this.expended,console.log(this.expended)}toggleChecked(){console.log("nodeInfo.toggleChecked"),this.checked=!this.checked,console.log(this.checked)}}const G="children";class Le{constructor(e){v(this,"childrenKey",G);v(this,"defaultOpen",!1);v(this,"noInitialization",!1);this.childrenKey=(e==null?void 0:e.childrenKey)||G,this.defaultOpen=(e==null?void 0:e.defaultOpen)||!1,this.noInitialization=(e==null?void 0:e.noInitialization)||!1}infoNodesHandler(e){return e}InfoNodesFlatHandler(e){return e}infoHandler(e){return e}}var fe,ue,ge;class gt{constructor(e,t){v(this,"nodeData");Ie(this,fe,j(b([])));Ie(this,ue,j(b([])));Ie(this,ge,j(null));v(this,"options");v(this,"afterSetInfoNode");v(this,"afterRemoveInfoNode");v(this,"initialized",!1);this.options=t||new Le}get nodeInfos(){return c(ee(this,fe))}set nodeInfos(e){D(ee(this,fe),b(e))}get nodeInfosToRender(){return c(ee(this,ue))}set nodeInfosToRender(e){D(ee(this,ue),b(e))}get _infosMap(){return c(ee(this,ge))}set _infosMap(e){D(ee(this,ge),b(e))}init(){if(!this.initialized){this.initialized=!0,console.log("TreeProcessor.init() called");const e=this.options.childrenKey,t=new Ae([]);this._infosMap=new Map,X(this.nodeData,(s,l,o,r)=>{const a=this.options.infoHandler(new he({nodeData:s,expended:!!this.options.defaultOpen,parent:t.getParent(r),children:[],level:r.length}));this._infosMap.set(s,a),t.set(r,a)},{childrenKey:e}),console.log("td",t),this.nodeInfos=this.options.infoNodesHandler(t.rootChildren);const n=[];t.walk(s=>{n.push(s)}),console.log("rootChildren",t.rootChildren),this.nodeInfosToRender=this.options.InfoNodesFlatHandler(n)}}getNodeInfo(e){const t=this._infosMap.get(e);if(!t)throw new Ee("NodeInfo not found");return t}has(e){if(e instanceof he)return this.nodeInfosToRender.indexOf(e)>-1;try{return(!!this.getNodeInfo(e)).valueOf()}catch(t){if(t instanceof Ee)return!1;throw t}}_getPathByStat(e){if(e===null)return[];const n=this.getSiblings(e).indexOf(e);return[...e.parent?this._getPathByStat(e.parent):[],n]}afterOneCheckChanged(e){const{checked:t}=e;if(e._ignoreCheckedOnce)return delete e._ignoreCheckedOnce,!1;const n=s=>{const l=s.parent;if(l){let o=!1,r=!1;for(const f of l.children)if(f.checked||f.checked===0)o=!0;else if(r=!0,o&&r)break;const a=r?o?0:!1:!0;l.checked!==a&&(this._ignoreCheckedOnce(l),l.checked=a),n(l)}};return n(e),X(e.children,s=>{s.checked!==t&&(this._ignoreCheckedOnce(s),s.checked=t)},{childrenKey:G}),!0}_ignoreCheckedOnce(e){e._ignoreCheckedOnce=!0,setTimeout(()=>{e._ignoreCheckedOnce&&(e._ignoreCheckedOnce=!1)},100)}isVisible(e){const t=e instanceof he?e:this.getNodeInfo(e),n=s=>!s||!s.hidden&&s.expended&&n(s.parent);return!!(!t.hidden&&n(t.parent))}updateCheckboxes(){X(this.nodeInfos,e=>{if(e.children&&e.children.length>0){const t=e.children.every(n=>n.checked);e.checked!==t&&(this._ignoreCheckedOnce(e),e.checked=t)}},{childFirst:!0,childrenKey:G})}getChecked(e=!1){return this.nodeInfosToRender.filter(t=>t.checked||e&&t.checked===0)}getUnchecked(e=!0){return this.nodeInfosToRender.filter(t=>e?!t.checked:t.checked===!1)}openAll(){for(const e of this.nodeInfosToRender)e.expended=!0}closeAll(){for(const e of this.nodeInfosToRender)e.expended=!1}openNodeAndParents(e){const t=e instanceof he?e:this.getNodeInfo(e);for(const n of this.iterateParent(t,{withSelf:!0}))n.expended=!0}_calcFlatIndex(e,t){let n=e?this.nodeInfosToRender.indexOf(e)+1:0;const s=e?e.children:this.nodeInfos;for(let l=0;l<t;(l+=1)-1)n+=this._count(s[l]);return n}add(e,t,n){if(this.has(e))throw"Can't add because data exists in tree";const s=t?t.children:this.nodeInfos;n==null&&(n=s.length);const l=this.options.infoHandler(new he({expended:!!this.options.defaultOpen,nodeData:e,parent:t||null,children:[],level:t?t.level+1:1}));this._setPosition(l,t||null,n);const o=e[this.childrenKey];if(o){const r=o.slice();for(const a of r)this.add(a,l)}}remove(e){var n,s;const t=this.getSiblings(e);if(t.includes(e)){Ke(t,e);const l=this._flat(e);this.nodeInfosToRender.splice(this.nodeInfosToRender.indexOf(e),l.length);for(const o of l)this._infosMap.delete(o.nodeData);return(s=(n=this.options).afterRemoveInfoNode)==null||s.call(n,e),!0}return!1}getSiblings(e){const{parent:t}=e;return t?t.children:this.nodeInfos}_setPosition(e,t,n){var r,a;(t?t.children:this.nodeInfos).splice(n,0,e),e.parent=t,e.level=t?t.level+1:1;const l=this._calcFlatIndex(t,n),o=this._flat(e);this.nodeInfosToRender.splice(l,0,...o);for(const f of o)this._infosMap.has(f.nodeData)||this._infosMap.set(f.nodeData,f);X(e,(f,A,g)=>{g&&(f.level=g.level+1)},{childrenKey:G}),(a=(r=this.options).afterSetInfoNode)==null||a.call(r,e,t,n)}*iterateParent(e,t){let n=t!=null&&t.withSelf?e:e.parent;for(;n;)yield n,n=n.parent}move(e,t,n){if(this.has(e)){if(e.parent===t&&this.getSiblings(e).indexOf(e)===n)return!1;if(e===t)throw new Error("Can't move node to itself");if(t&&e.level<t.level){let s;for(const l of this.iterateParent(t))if(l.level===e.level){s=l;break}if(e===s)throw new Error("Can't move node to its descendant")}this.remove(e)}return this._setPosition(e,t,n),!0}_flat(e){const t=[];return X(e,n=>{t.push(n)},{childrenKey:G}),t}_count(e){return this._flat(e).length}getData(e,t){const{childrenKey:n}=this.options,s=new Ae([]);return s.childrenKey=n,X(t||this.nodeInfos,(l,o,r,a)=>{let f={...l.nodeData,[n]:[]};e&&(f=e(f)),s.set(a,f)},{childrenKey:G}),s.data}}fe=new WeakMap,ue=new WeakMap,ge=new WeakMap;class Ee extends Error{constructor(e){super(e),this.name="StatNotFoundError"}}class mt extends Le{constructor(t){super(t);v(this,"preProcessor")}filter(t,n){return t?t(n):n}infoHandler(t){this.preProcessor&&(t=this.preProcessor(t));let n=b(t);return this.filter(super.infoHandler,n)}infoNodesHandler(t){let n=b(t);return this.filter(super.infoNodesHandler,n)}InfoNodesFlatHandler(t){let n=b(t);return this.filter(super.InfoNodesFlatHandler,n)}}function vt(i,e){const t=new mt(e),n=new gt(i,t);return t.noInitialization||n.init(),n}var It=Z('<div class="drag-placeholder he-tree-drag-placeholder"><!></div>');function _t(i,e){ze(e,!0);let t=I(e,"processor",23,()=>vt([],{noInitialization:!0})),n=I(e,"updateBehavior",3,"modify"),s=I(e,"childrenKey",3,G);I(e,"textKey",3,"text");let l=I(e,"indent",3,20),o=I(e,"virtualization",3,!1);I(e,"virtualizationPrerenderCount",3,20),I(e,"defaultOpen",3,!0);let r=I(e,"rtl",3,!1),a=I(e,"btt",3,!1);I(e,"nodeKey",3,"index");let f=I(e,"treeLine",3,!1),A=I(e,"treeLineOffset",3,8);I(e,"class",3,"");let g=I(e,"style",3,"");const m=u=>u?(u[s()]||(u[s()]=[]),u[s()]):c(_);t().afterSetInfoNode=(u,E,H)=>{let d=c(_);if(n()==="new"){if(w)return;d=ne()}else if(n()==="modify"){const h=m(E==null?void 0:E.nodeData);h.includes(u.nodeData)||h.splice(H,0,u.nodeData)}else n();w||q(d)},t().afterRemoveInfoNode=u=>{var H;let E=c(_);if(n()==="new"){if(w)return;E=ne()}else if(n()==="modify"){const d=m((H=u.parent)==null?void 0:H.nodeData);Ke(d,u.nodeData)}else n();w||q(E)};let C,N=j(b([])),y=j(b([])),P=null,z=!1,k={},w=!1,x=!1,_=J(()=>e.model);re(()=>{console.log("model change detected"),x?x=!1:(console.log("Initializing model"),t().nodeData=e.model,t().init(),D(N,b(t().nodeInfos)),D(y,b(t().nodeInfosToRender)))});function L(){let u=c(y)||[];return a()&&(u=u.slice(),u.reverse()),u.filter(E=>ce(E))}function F(u){e.onUpdateValue&&e.onUpdateValue(u)}function q(u){return n()==="disabled"?!1:(u!==c(_)&&(x=!0),F(u),!0)}function ce(u){return t().isVisible(u)}function ne(u,E){return t().getData(u,E)}var me=J(()=>be("he-tree",r()&&"he-tree--rtl rtl",z)),xe=J(()=>!o()),W=J(L),ve=J(()=>{var u;return((u=t().nodeInfos)==null?void 0:u.length)||0});Ne(it(i,{get class(){return c(me)},get style(){return g()},height:500,get isDisabled(){return c(xe)},width:"auto",get model(){return c(W)},get modelCount(){return c(ve)},itemSize:25,vl_slot:(E,H)=>{let d=()=>H==null?void 0:H().item;var h=V(),O=M(h);Q(O,d,U=>{var B=J(()=>be(d().class,{"drag-placeholder-wrapper":d().nodeData===k,"dragging-node":d()===P}));dt(U,{get class(){return c(B)},get style(){return d().style},get nodeInfo(){return d()},get rtl(){return r()},get btt(){return a()},get indent(){return l()},get treeLine(){return f()},get treeLineOffset(){return A()},get processor(){return t()},onNodeOpened:R=>{var S;return(S=e.onNodeOpened)==null?void 0:S.call(e,R)},onNodeClosed:R=>{var S;return(S=e.onNodeClosed)==null?void 0:S.call(e,R)},onNodeSelected:R=>{var S;return(S=e.onNodeSelected)==null?void 0:S.call(e,R)},onNodeChecked:R=>{var S;return(S=e.onNodeChecked)==null?void 0:S.call(e,R)},tn_slot:(R,S=We)=>{var Pe=V(),Ve=M(Pe);Q(Ve,()=>S().data===k,Te=>{var ie=It(),Ce=p(ie);Q(Ce,()=>e.placeholder,He=>{var ke=V(),Ue=M(ke);te(Ue,()=>e.placeholder),T(He,ke)}),$(ie),T(Te,ie)},Te=>{var ie=V(),Ce=M(ie);te(Ce,()=>e.tree_slot,S),T(Te,ie)}),T(R,Pe)},$$slots:{tn_slot:!0}})}),T(E,h)},$$slots:{vl_slot:!0}}),E=>C=E,()=>C),ye()}var St=Z('<div class="item svelte-1s0qzrn"><!></div>'),zt=Z('<section class="svelte-1s0qzrn"><!></section>'),yt=Z("<b> </b> <!>",1);function Fe(i,e){ze(e,!0);let t=I(e,"tree",15),n=I(e,"node",7);const s=300;function l(g){n().children=g.detail.items}function o(g){n().children=g.detail.items,t({...t()})}var r=yt(),a=M(r),f=p(a);$(a);var A=ae(a,2);Q(A,()=>{var g;return(g=n())==null?void 0:g.children},g=>{var m=zt(),C=p(m);Q(C,()=>n().children,N=>{var y=V(),P=M(y);Se(P,25,()=>n().children,z=>z.id,(z,k)=>{var w=St(),x=p(w);Fe(x,{get tree(){return t()},set tree(_){t(_)},get node(){return t()[c(k).id]}}),$(w),Xe(w,()=>pe,()=>({duration:s})),T(z,w)}),T(N,y)}),$(m),Re("consider",m,l),Re("finalize",m,o),Ge(m,(N,y)=>$e(N,y),()=>({items:n().children||[],flipDurationMs:s,centreDraggedOnCursor:!0})),T(g,m)}),le(()=>{var g,m;de(a,"style",`color:${((g=n())==null?void 0:g.color)??""}`),Ye(f,(m=n())==null?void 0:m.name)}),T(i,r),ye()}var xt=Z("<h3>Try dragging node2 into node3 and then node4 into node2</h3> <!>",1);function bt(i){let e=j(b({node1:{name:"node 1",children:[{id:"node2"},{id:"node3"},{id:"node4"}],id:"node1"},node2:{name:"node 2",children:[{id:"node5"},{id:"node6"},{id:"node7"},{id:"node8"}],id:"node2"},node3:{name:"node 3",children:[{id:"node9"},{id:"node10"},{id:"node11"},{id:"node12"}],id:"node3"},node4:{name:"node 4",children:[{id:"node13"},{id:"node14"},{id:"node15"},{id:"node16"}],id:"node4",color:"salmon"}}));for(let s=5;s<17;(s+=1)-1)c(e)[`node${s}`]={id:`node${s}`,name:`item ${s}`};c(e).node10.color="steelblue",c(e).node11.color="steelblue",c(e).node14.color="orange",c(e).node15.color="orange",c(e).node6.color="forestgreen";var t=xt(),n=ae(M(t),2);Fe(n,{get node(){return c(e).node1},get tree(){return c(e)},set tree(s){D(e,b(s))}}),T(i,t)}export{bt as A,_t as T};
