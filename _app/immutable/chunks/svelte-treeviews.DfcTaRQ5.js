var Je=Object.defineProperty;var De=i=>{throw TypeError(i)};var We=(i,e,t)=>e in i?Je(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var I=(i,e,t)=>We(i,typeof e!="symbol"?e+"":e,t),Ye=(i,e,t)=>e.has(i)||De("Cannot "+t);var k=(i,e,t)=>(Ye(i,e,"read from private field"),t?t.call(i):e.get(i)),q=(i,e,t)=>e.has(i)?De("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t);import{d as Xe,p as Oe,a as g,s as D,b as S,u as ae,o as Ge,c as pe,g as a,e as A,f as Fe,i as J,t as oe,h as C,j as be,k as W,l as he,m as j,n as L,q as _e,r as te,v as we,w as ne,x as Ve,y as ce,z as ie,A as Ne,B as G,C as $e,D as et,E as tt,F as Ke,G as nt,H as it,I as st}from"./external.DybHjibF.js";Xe(["click"]);class lt{constructor(e,t,n,s){I(this,"model");I(this,"modelCount");I(this,"itemSize");I(this,"estimatedItemSize");I(this,"itemSizeAndPositionData");I(this,"lastMeasuredIndex");I(this,"totalSize");this.model=e,this.itemSize=n,this.modelCount=t,this.estimatedItemSize=s,this.itemSizeAndPositionData=[],this.lastMeasuredIndex=-1,this.checkForMismatchItemSizeAndItemCount(),this.justInTime||this.computeTotalSizeAndPositionData()}get justInTime(){return typeof this.itemSize=="function"}updateConfig(e,t,n){t!==void 0&&(this.modelCount=t),n!==void 0&&(this.estimatedItemSize=n),e!==void 0&&(this.itemSize=e),this.checkForMismatchItemSizeAndItemCount(),this.justInTime&&this.totalSize!==void 0?this.totalSize=void 0:this.computeTotalSizeAndPositionData()}checkForMismatchItemSizeAndItemCount(){if(Array.isArray(this.itemSize)&&this.itemSize.length<this.modelCount)throw Error("When itemSize is an array, itemSize.length can't be smaller than itemCount")}getSize(e){const{itemSize:t}=this;return typeof t=="function"?this.model?t(this.model[e],e):0:Array.isArray(t)?t[e]:t}computeTotalSizeAndPositionData(){let e=0;for(let t=0;t<this.modelCount;t++){const n=this.getSize(t),s=e;e+=n,this.itemSizeAndPositionData[t]={offset:s,size:n}}this.totalSize=e}getLastMeasuredIndex(){return this.lastMeasuredIndex}getSizeAndPositionForIndex(e){return e<0||e>=this.modelCount?{size:0,offset:0}:this.justInTime?this.getJustInTimeSizeAndPositionForIndex(e):this.itemSizeAndPositionData[e]}getJustInTimeSizeAndPositionForIndex(e){if(e>this.lastMeasuredIndex){const t=this.getSizeAndPositionOfLastMeasuredItem();let n=t.offset+t.size;for(let s=this.lastMeasuredIndex+1;s<=e;s++){const l=this.getSize(s);if(l===void 0||isNaN(l))throw Error(`Invalid size returned for index ${s} of value ${l}`);this.itemSizeAndPositionData[s]={offset:n,size:l},n+=l}this.lastMeasuredIndex=e}return this.itemSizeAndPositionData[e]}getSizeAndPositionOfLastMeasuredItem(){return this.lastMeasuredIndex>=0?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}}getEstimatedItemSize(){return this.estimatedItemSize||typeof this.itemSize=="number"&&this.itemSize||50}getTotalSize(){if(this.totalSize)return this.totalSize;const e=this.getSizeAndPositionOfLastMeasuredItem();return e.offset+e.size+(this.modelCount-this.lastMeasuredIndex-1)*this.getEstimatedItemSize()}getUpdatedOffsetForIndex(e=de.START,t,n,s){if(t<=0)return 0;const l=this.getSizeAndPositionForIndex(s),r=l.offset,o=r-t+l.size;let d;switch(e){case de.END:d=o;break;case de.CENTER:d=r-(t-l.size)/2;break;case de.START:d=r;break;default:d=Math.max(o,Math.min(r,n))}const m=this.getTotalSize();return Math.max(0,Math.min(m-t,d))}getVisibleRange(e=0,t,n){if(this.getTotalSize()===0)return{start:0,end:0};const l=t+e;let r=this.findNearestItem(t);if(r===void 0)throw Error(`Invalid offset ${t} specified`);const o=this.getSizeAndPositionForIndex(r);t=o.offset+o.size;let d=r;for(;t<l&&d<this.modelCount-1;)d++,t+=this.getSizeAndPositionForIndex(d).size;return n&&(r=Math.max(0,r-n),d=Math.min(d+n,this.modelCount-1)),{start:r,end:d}}resetItem(e){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,e-1)}findNearestItem(e){if(isNaN(e))throw Error(`Invalid offset ${e} specified`);e=Math.max(0,e);const t=this.getSizeAndPositionOfLastMeasuredItem(),n=Math.max(0,this.lastMeasuredIndex);return t.offset>=e?this.binarySearch(0,n,e):this.exponentialSearch(n,e)}binarySearch(e,t,n){let s=0,l=0;for(;e<=t;){if(s=e+Math.floor((t-e)/2),l=this.getSizeAndPositionForIndex(s).offset,l===n)return s;l<n?e=s+1:l>n&&(t=s-1)}return e>0?e-1:0}exponentialSearch(e,t){let n=1;for(;e<this.modelCount&&this.getSizeAndPositionForIndex(e).offset<t;)e+=n,n*=2;return this.binarySearch(Math.floor(e/2),Math.min(e,this.modelCount-1),t)}}const rt=(()=>{let i=!1;try{const e=Object.defineProperty({},"passive",{get(){return i={passive:!0},!0}});window.addEventListener("testpassive",e,e),window.remove("testpassive",e,e)}catch{}return i})();var ot=W('<div><!> <div class="virtual-list-inner svelte-f32i87"><!></div> <!></div>');function dt(i,e){Oe(e,!0);const t=g(e,"width",3,"100%"),n=g(e,"model",19,()=>[]),s=g(e,"windowOverPadding",3,3),l=g(e,"scrollDirection",19,()=>H.VERTICAL),r=g(e,"scrollToAlignment",19,()=>de.AUTO),o=g(e,"scrollToBehaviour",19,()=>He.INSTANT),d=g(e,"class",3,"");g(e,"style",3,"");const m={[H.VERTICAL]:"top",[H.HORIZONTAL]:"left"},_={[H.VERTICAL]:"scrollTop",[H.HORIZONTAL]:"scrollLeft"},v=new lt(n(),e.modelCount,e.itemSize,e.estimatedItemSize);let h=!1,O,K=D(S([])),y=D(S({offset:e.scrollOffset||e.scrollToIndex!==void 0&&e.modelCount&&fe(e.scrollToIndex)||0,scrollChangeReason:re.REQUESTED})),w={},z={scrollToIndex:e.scrollToIndex,scrollToAlignment:r(),scrollOffset:e.scrollOffset,modelCount:e.modelCount,itemSize:e.itemSize,estimatedItemSize:e.estimatedItemSize},N={},R=D(""),T=D("");ae(()=>{e.scrollToIndex,r(),e.scrollOffset,e.modelCount,e.itemSize,e.estimatedItemSize,b()}),ae(()=>{a(y),U()}),ae(()=>{e.height,t(),h&&se(0)}),(()=>{if(l()===H.VERTICAL&&typeof e.height!="number")throw new Error("virtual list's height must be a number when scrollDirection is 'vertical', got "+e.height);if(l()===H.HORIZONTAL&&typeof t()!="number")throw new Error("virtual list's width must be a number if scrollDirection is 'horizontal', got "+t());B()})(),Ge(()=>{O.addEventListener("scroll",Ce,rt),e.scrollOffset!==void 0?Y(e.scrollOffset):e.scrollToIndex!==void 0&&Y(fe(e.scrollToIndex)),h=!0}),pe(()=>{h&&O.removeEventListener("scroll",Ce)});function b(){if(!h)return;e.scrollToIndex&&e.scrollOffset&&console.log("VirtualList: scrollToIndex and scrollOffset shall not be used together.");const c=z.scrollToIndex!==e.scrollToIndex||z.scrollToAlignment!==r(),f=z.modelCount!==e.modelCount||z.itemSize!==e.itemSize||z.estimatedItemSize!==e.estimatedItemSize;f&&(v.updateConfig(e.itemSize,e.modelCount,e.estimatedItemSize),se()),z.scrollOffset!==e.scrollOffset?A(y,S({offset:e.scrollOffset||0,scrollChangeReason:re.REQUESTED})):typeof e.scrollToIndex=="number"&&(c||f)&&A(y,S({offset:fe(e.scrollToIndex,r(),e.modelCount),scrollChangeReason:re.REQUESTED})),z={scrollToIndex:e.scrollToIndex,scrollToAlignment:r(),scrollOffset:e.scrollOffset,modelCount:e.modelCount,itemSize:e.itemSize,estimatedItemSize:e.estimatedItemSize}}function U(){if(!h)return;const{offset:c,scrollChangeReason:f}=a(y);(w.offset!==c||w.scrollChangeReason!==f)&&B(),w.offset!==c&&f===re.REQUESTED&&Y(c),w=a(y)}function B(){if(n().length===0||e.isDisabled)return;const{offset:c}=a(y);let{start:f,end:P}=v.getVisibleRange(l()===H.VERTICAL?e.height:t(),c,s()),Z=[];const X=v.getTotalSize(),M=typeof e.height=="number"?"px":"",x=typeof t()=="number"?"px":"";if(l()===H.VERTICAL?(A(R,`height:${e.height}${M};width:${t()}${x};`),A(T,`flex-direction:column;height:${X}px;`)):(A(R,`height:${e.height}${M};width:${t()}${x};`),A(T,`min-height:100%;width:${X}px;`)),n()&&f!==void 0&&P!==void 0){for(let V=f;V<=P;(V+=1)-1)Z.push({item:n()[V],index:V,style:Ae(V)});if(e.onVisibleRangeUpdate){const V=v.getVisibleRange(l()===H.VERTICAL?e.height:t(),c,0);e.onVisibleRangeUpdate({type:"range.update",start:V.start,end:V.end})}}A(K,S(Z))}function Y(c){"scroll"in O?O.scroll({[m[l()]]:c,behavior:o()}):O[_[l()]]=c}function se(c=0){N={},v.resetItem(c),B()}function fe(c,f=r(),P=e.modelCount){return c<0?c=0:c>=P&&(c=P-1),v.getUpdatedOffsetForIndex(f,l()===H.VERTICAL?e.height:t(),a(y).offset||0,c)}const Ce=c=>{const f=O[_[l()]];f<0||a(y).offset===f||c.target!==O||(A(y,S({offset:f,scrollChangeReason:re.OBSERVED})),e.onAfterScroll&&e.onAfterScroll({type:"scroll.update",offset:f,event:c}))};function Ae(c){if(N[c])return N[c];const{size:f,offset:P}=v.getSizeAndPositionForIndex(c),Z=l()===H.VERTICAL?`left:0;width:100%;height:${f}px;position:absolute;top:${P}px;`:`top:0;width:${f}px;position:absolute;height:100%;left:${P}px;`;return N[c]=Z}var p=ot();Fe(p,c=>O=c,()=>O);var u=te(p);J(u,()=>e.header,c=>{var f=j(),P=L(f);ie(P,()=>e.header),C(c,f)});var E=he(u,2),Q=te(E);J(Q,()=>e.isDisabled,c=>{var f=j(),P=L(f);_e(P,17,n,we,(Z,X,M)=>{var x=j(),V=L(x);ie(V,()=>e.vl_slot,()=>({item:a(X),style:"",index:M})),C(Z,x)}),C(c,f)},c=>{var f=j(),P=L(f);_e(P,17,()=>a(K),we,(Z,X)=>{var M=j(),x=L(M);ie(x,()=>e.vl_slot,()=>({item:a(X).item,style:a(X).style,index:a(X).index})),C(Z,M)}),C(c,f)}),ne(E);var F=he(E,2);return J(F,()=>e.footer,c=>{var f=j(),P=L(f);ie(P,()=>e.footer),C(c,f)}),ne(p),oe(()=>{Ve(p,`virtual-list-wrapper $${d()??""} svelte-f32i87`),ce(p,"style",a(R)),ce(E,"style",a(T))}),C(i,p),be({recomputeSizes:se})}var He=(i=>(i.AUTO="auto",i.SMOOTH="smooth",i.INSTANT="instant",i))(He||{}),de=(i=>(i.AUTO="auto",i.START="start",i.CENTER="center",i.END="end",i))(de||{}),H=(i=>(i.HORIZONTAL="horizontal",i.VERTICAL="vertical",i))(H||{}),re=(i=>(i[i.OBSERVED=0]="OBSERVED",i[i.REQUESTED=1]="REQUESTED",i))(re||{}),at=W('<div class="tree-line tree-vline svelte-gfld7i"></div>'),ct=W('<div class="tree-line tree-hline svelte-gfld7i"></div>'),ht=W("<!> <!>",1),ft=W('<div><!> <div class="tree-node-inner"><!></div></div>');function ut(i,e){Oe(e,!0);let t=g(e,"rtl",3,!1),n=g(e,"btt",3,!1),s=g(e,"indent",3,20),l=g(e,"treeLine",3,!0),r=g(e,"treeLineOffset",3,10),o=G(()=>`${t()?"paddingRight":"paddingLeft"}:${s()*(e.nodeInfo.level-1)}px`),d=G(()=>`${t()?"right":"left"}:${(e.nodeInfo.level-2)*s()+r()}px`);ae(()=>{var w,z;e.nodeInfo.checked,!m&&(w=e.processor)!=null&&w.afterOneCheckChanged(e.nodeInfo)&&((z=e.onNodeChecked)==null||z.call(e,e.nodeInfo))}),ae(()=>{var z,N;const w=e.nodeInfo.expended;console.log("toggleOpen"),!m&&(w?(z=e.onNodeOpened)==null||z.call(e,e.nodeInfo):(N=e.onNodeClosed)==null||N.call(e,e.nodeInfo),_())});let m=!1;const _=()=>{m=!0,setTimeout(()=>{m=!1},100)},v=G(()=>{const w=[],z=b=>{var U;if(b.parent){let B=(U=b.parent)==null?void 0:U.children.indexOf(b);do{B+=1;const Y=b.parent.children[B];if(Y){if(!Y.hidden)return!0}else break}while(!0)}return!1},N=t()?"right":"left",R=n()?"top":"bottom";let T=e.nodeInfo;for(;T;){const b=(T.level-2)*s()+r(),U=z(T),B=()=>{w.push({style:`${N}:${b}px;${R}:${U?"0":"50%"}`})};T===e.nodeInfo?T.level>1&&B():U&&B(),T=T.parent}return w});var h=ft();oe(()=>Ve(h,`${Ne("tree-node",e.class,l()&&"tree-node--with-tree-line")??""} svelte-gfld7i`));var O=te(h);J(O,l,w=>{var z=ht(),N=L(z);_e(N,17,()=>a(v),we,(T,b)=>{var U=at();oe(()=>ce(U,"style",a(b).style)),C(T,U)});var R=he(N,2);J(R,()=>e.nodeInfo.level>1,T=>{var b=ct();oe(()=>ce(b,"style",a(d))),C(T,b)}),C(w,z)});var K=he(O,2),y=te(K);ie(y,()=>e.tn_slot,()=>({data:e.nodeInfo.data,info:e.nodeInfo})),ne(K),ne(h),oe(()=>ce(h,"style",`${e.style} ${a(o)}`)),C(i,h),be()}function Re(i){return Object.prototype.toString.call(i)==="[object Array]"}function gt(i){return i[i.length-1]}function Ue(i,e){let t,n=0;for(;(t=i.indexOf(e))>-1;)i.splice(t,1),n++;return n}function mt(i,e,t){i.hasOwnProperty(e)||(i[e]=t)}function vt(i,e){return Object.keys(e).forEach(t=>{mt(i,t,e[t])}),i}function It(i){const e={};return Object.keys(i).forEach(t=>{i[t]!==void 0&&(e[t]=i[t])}),e}function $(i,e,t={}){t=vt({...t},{childrenKey:"children"});const n=t.childrenKey,s=Re(i)?i:[i];class l{}const r=(o,d,m)=>{t.reverse&&(o=o.slice(),o.reverse());const _=o.length;for(let v=0;v<_;v++){const h=o[v],O=t.reverse?_-v-1:v,K=m?[...m,O]:[];t.childFirst&&h[n]!=null&&r(h[n],h,K);const y=e(h,O,d,K);if(y===!1)throw new l;if(y==="skip children")continue;if(y==="skip siblings")break;t.childFirst||h[n]!=null&&r(h[n],h,K)}};try{r(s,null,Re(i)?[]:null)}catch(o){if(!(o instanceof l))throw o}}function St(i,e){const t={childrenKey:"children"};e&&Object.assign(t,e);const n=t.childrenKey,s=t.nodeHandler,l=new Ee;return l.childrenKey=n,$(i,(r,o,d,m)=>{let _=Object.assign({},r);_[n]&&(_[n]=[]),s&&(_=s(_,{oldNode:r,index:o,parent:d,path:m})),l.set(m,_)},{childrenKey:n}),l.data}class Ee{constructor(e=[]){I(this,"data");I(this,"childrenKey","children");this.data=e}get rootChildren(){const{childrenKey:e}=this,{data:t}=this;return Re(t)?t:t[e]}*iteratePath(e,t={}){const{childrenKey:n,rootChildren:s}=this;if(t.reverse){const l=[...this.iteratePath(e,{...t,reverse:!1})];l.reverse();for(const{path:r,node:o}of l)yield{path:r,node:o}}else{let l=[],r=s;for(const o of e){const d=[...l,o],m=r[o];yield{path:d,node:m},l=d,r=m[n]}}}getFamily(e){const t=[];for(const{node:n}of this.iteratePath(e))t.push(n);return t}get(e){return gt(this.getFamily(e))}getParentAndIndex(e){const t=e.slice(),n=t.pop();return{parent:this.get(t),index:n,parentPath:t}}getParent(e){return this.getParentAndIndex(e).parent}set(e,t){if(e===null||e.length===0)this.data=t;else{const{childrenKey:n}=this;let{rootChildren:s}=this;const{parent:l,index:r}=this.getParentAndIndex(e);let o;e.length===1?(s||(this.data?this.data[n]=[]:this.data=[]),o=s):(l[n]||(l[n]=[]),o=l[n]),o[r]=t}}delete(e){const{childrenKey:t,rootChildren:n}=this,{parent:s,index:l}=this.getParentAndIndex(e),r=e.length===1?n:s[t],o=r[l];return r.splice(l,1),o}walk(e,t){const{childrenKey:n,data:s}=this;return $(s,e,n)}clone(e={}){return St(this.data),It({childrenKey:this.childrenKey,nodeHandler:e.nodeHandler||void 0})}}var ge,me,ve,Ie,Se,ze;class ue{constructor(e){I(this,"data");q(this,ge,D(!1));I(this,"parent",null);q(this,me,D(S([])));I(this,"level",0);q(this,ve,D(!1));q(this,Ie,D(!1));I(this,"draggable");I(this,"droppable");q(this,Se,D(""));q(this,ze,D(""));I(this,"_ignoreCheckedOnce");this.data=(e==null?void 0:e.data)||null,this.expended=(e==null?void 0:e.expended)||!1,this.parent=(e==null?void 0:e.parent)||null,this.children=(e==null?void 0:e.children)||[],this.level=(e==null?void 0:e.level)||0,this.hidden=(e==null?void 0:e.hidden)||!1,this.checked=(e==null?void 0:e.checked)||!1,this.draggable=(e==null?void 0:e.draggable)||null,this.droppable=(e==null?void 0:e.droppable)||null,this.style=e==null?void 0:e.style,this.class=e==null?void 0:e.class,this._ignoreCheckedOnce=e==null?void 0:e._ignoreCheckedOnce}get expended(){return a(k(this,ge))}set expended(e){A(k(this,ge),S(e))}get children(){return a(k(this,me))}set children(e){A(k(this,me),S(e))}get hidden(){return a(k(this,ve))}set hidden(e){A(k(this,ve),S(e))}get checked(){return a(k(this,Ie))}set checked(e){A(k(this,Ie),S(e))}get style(){return a(k(this,Se))}set style(e){A(k(this,Se),S(e))}get class(){return a(k(this,ze))}set class(e){A(k(this,ze),S(e))}toggleExpand(){console.log("nodeInfo.toggleExpand"),this.expended=!this.expended,console.log(this.expended)}toggleChecked(){console.log("nodeInfo.toggleChecked"),this.checked=!this.checked,console.log(this.checked)}}ge=new WeakMap,me=new WeakMap,ve=new WeakMap,Ie=new WeakMap,Se=new WeakMap,ze=new WeakMap;const ee="children";class Be{constructor(e){I(this,"childrenKey",ee);I(this,"defaultOpen",!1);I(this,"noInitialization",!1);this.childrenKey=(e==null?void 0:e.childrenKey)||ee,this.defaultOpen=(e==null?void 0:e.defaultOpen)||!1,this.noInitialization=(e==null?void 0:e.noInitialization)||!1}}var ye,xe,Te;class zt{constructor(e,t){I(this,"rawData");q(this,ye,D(S([])));q(this,xe,D(S([])));q(this,Te,D(S(new Map)));I(this,"options");I(this,"afterSetInfoNode");I(this,"afterRemoveInfoNode");I(this,"infoNodesHandler");I(this,"infoNodesFlatHandler");I(this,"infoHandler",e=>e);I(this,"initialized",!1);this.options=t||new Be}get nodeInfos(){return a(k(this,ye))}set nodeInfos(e){A(k(this,ye),S(e))}get nodeInfosToRender(){return a(k(this,xe))}set nodeInfosToRender(e){A(k(this,xe),S(e))}get _infosMap(){return a(k(this,Te))}set _infosMap(e){A(k(this,Te),S(e))}init(){if(!this.initialized){this.initialized=!0,console.log("TreeProcessor.init() called");const e=this.options.childrenKey,t=new Ee([]);this._infosMap.clear(),$(this.rawData,(s,l,r,o)=>{const d=this.infoHandler(new ue({data:s,expended:this.options.defaultOpen,parent:t.getParent(o),children:[],level:o.length}));this._infosMap.set(s,d),t.set(o,d)},{childrenKey:e}),console.log("td",t);const n=[];t.walk(s=>{n.push(s)}),console.log("flat",n),this.nodeInfos=this.infoNodesHandler?this.infoNodesHandler(t.rootChildren):t.rootChildren,this.nodeInfosToRender=this.infoNodesFlatHandler?this.infoNodesFlatHandler(n):n}}getNodeInfo(e){const t=this._infosMap.get(e);if(!t)throw new Le("NodeInfo not found");return t}has(e){if(e instanceof ue)return this.nodeInfosToRender.indexOf(e)>-1;try{return(!!this.getNodeInfo(e)).valueOf()}catch(t){if(t instanceof Le)return!1;throw t}}_getPathByStat(e){if(e===null)return[];const n=this.getSiblings(e).indexOf(e);return[...e.parent?this._getPathByStat(e.parent):[],n]}afterOneCheckChanged(e){const{checked:t}=e;if(e._ignoreCheckedOnce)return delete e._ignoreCheckedOnce,!1;const n=s=>{const l=s.parent;if(l){let r=!1,o=!1;for(const m of l.children)if(m.checked||m.checked===0)r=!0;else if(o=!0,r&&o)break;const d=o?r?0:!1:!0;l.checked!==d&&(this._ignoreCheckedOnce(l),l.checked=d),n(l)}};return n(e),$(e.children,s=>{s.checked!==t&&(this._ignoreCheckedOnce(s),s.checked=t)},{childrenKey:ee}),!0}_ignoreCheckedOnce(e){e._ignoreCheckedOnce=!0,setTimeout(()=>{e._ignoreCheckedOnce&&(e._ignoreCheckedOnce=!1)},100)}isVisible(e){const t=e instanceof ue?e:this.getNodeInfo(e),n=s=>!s||!s.hidden&&s.expended&&n(s.parent);return!t.hidden&&n(t.parent)}updateCheckboxes(){$(this.nodeInfos,e=>{if(e.children&&e.children.length>0){const t=e.children.every(n=>n.checked);e.checked!==t&&(this._ignoreCheckedOnce(e),e.checked=t)}},{childFirst:!0,childrenKey:ee})}getChecked(e=!1){return this.nodeInfosToRender.filter(t=>t.checked||e&&t.checked===0)}getUnchecked(e=!0){return this.nodeInfosToRender.filter(t=>e?!t.checked:t.checked===!1)}openAll(){for(const e of this.nodeInfosToRender)e.expended=!0}closeAll(){for(const e of this.nodeInfosToRender)e.expended=!1}openNodeAndParents(e){const t=e instanceof ue?e:this.getNodeInfo(e);for(const n of this.iterateParent(t,{withSelf:!0}))n.expended=!0}_calcFlatIndex(e,t){let n=e?this.nodeInfosToRender.indexOf(e)+1:0;const s=e?e.children:this.nodeInfos;for(let l=0;l<t;(l+=1)-1)n+=this._count(s[l]);return n}add(e,t,n){if(this.has(e))throw"Can't add because data exists in tree";const s=t?t.children:this.nodeInfos;n==null&&(n=s.length);const l=this.infoHandler(new ue({expended:!!this.options.defaultOpen,data:e,parent:t||null,children:[],level:t?t.level+1:1}));this._setPosition(l,t||null,n);const r=e[this.childrenKey];if(r){const o=r.slice();for(const d of o)this.add(d,l)}}remove(e){var n;const t=this.getSiblings(e);if(t.includes(e)){Ue(t,e);const s=this._flat(e);this.nodeInfosToRender.splice(this.nodeInfosToRender.indexOf(e),s.length);for(const l of s)this._infosMap.delete(l.data);return(n=this.afterRemoveInfoNode)==null||n.call(this,e),!0}return!1}getSiblings(e){const{parent:t}=e;return t?t.children:this.nodeInfos}_setPosition(e,t,n){var o;(t?t.children:this.nodeInfos).splice(n,0,e),e.parent=t,e.level=t?t.level+1:1;const l=this._calcFlatIndex(t,n),r=this._flat(e);this.nodeInfosToRender.splice(l,0,...r);for(const d of r)this._infosMap.has(d.data)||this._infosMap.set(d.data,d);$(e,(d,m,_)=>{_&&(d.level=_.level+1)},{childrenKey:ee}),(o=this.afterSetInfoNode)==null||o.call(this,e,t,n)}*iterateParent(e,t){let n=t!=null&&t.withSelf?e:e.parent;for(;n;)yield n,n=n.parent}move(e,t,n){if(this.has(e)){if(e.parent===t&&this.getSiblings(e).indexOf(e)===n)return!1;if(e===t)throw new Error("Can't move node to itself");if(t&&e.level<t.level){let s;for(const l of this.iterateParent(t))if(l.level===e.level){s=l;break}if(e===s)throw new Error("Can't move node to its descendant")}this.remove(e)}return this._setPosition(e,t,n),!0}_flat(e){const t=[];return $(e,n=>{t.push(n)},{childrenKey:ee}),t}_count(e){return this._flat(e).length}getData(e,t){const{childrenKey:n}=this.options,s=new Ee([]);return s.childrenKey=n,$(t||this.nodeInfos,(l,r,o,d)=>{let m={...l.data,[n]:[]};e&&(m=e(m)),s.set(d,m)},{childrenKey:ee}),s.data}}ye=new WeakMap,xe=new WeakMap,Te=new WeakMap;class Le extends Error{constructor(e){super(e),this.name="StatNotFoundError"}}class yt extends Be{constructor(t){super(t);I(this,"preProcessor")}filter(t,n){return t?t(n):n}infoHandler(t){this.preProcessor&&(t=this.preProcessor(t));let n=S(t);return this.filter(super.infoHandler,n)}infoNodesHandler(t){let n=S(t);return this.filter(super.infoNodesHandler,n)}InfoNodesFlatHandler(t){let n=S(t);return this.filter(super.InfoNodesFlatHandler,n)}}function xt(i,e){const t=new yt(e),n=new zt(i,t);return t.noInitialization||n.init(),n}var Tt=W('<div class="drag-placeholder he-tree-drag-placeholder"><!></div>');function kt(i,e){Oe(e,!0);let t=g(e,"processor",23,()=>xt([],{noInitialization:!0})),n=g(e,"updateBehavior",3,"modify"),s=g(e,"childrenKey",3,ee);g(e,"textKey",3,"text"),g(e,"nodeKey",3,"index");let l=g(e,"indent",3,20),r=g(e,"virtualization",3,!1);g(e,"virtualizationPrerenderCount",3,20),g(e,"defaultOpen",3,!0);let o=g(e,"rtl",3,!1),d=g(e,"btt",3,!1),m=g(e,"treeLine",3,!1),_=g(e,"treeLineOffset",3,8);g(e,"class",3,"");let v=g(e,"style",3,"");const h=u=>u?(u[s()]||(u[s()]=[]),u[s()]):a(b);t().afterSetInfoNode=(u,E,Q)=>{let F=a(b);if(n()==="new"){if(R)return;F=se()}else if(n()==="modify"){const c=h(E==null?void 0:E.data);c.includes(u.data)||c.splice(Q,0,u.data)}else n();R||Y(F)},t().afterRemoveInfoNode=u=>{var Q;let E=a(b);if(n()==="new"){if(R)return;E=se()}else if(n()==="modify"){const F=h((Q=u.parent)==null?void 0:Q.data);Ue(F,u.data)}else n();R||Y(E)};let O,K=D(S([])),y=D(S([])),w=null,z=!1,N={},R=!1,T=!1,b=G(()=>e.model);ae(()=>{console.log("model change detected"),T?T=!1:(console.log("Initializing model"),t().rawData=e.model,t().init(),A(K,S(t().nodeInfos)),A(y,S(t().nodeInfosToRender)))});function U(){console.log("filterVisibleNodes");let u=a(y)||[];return d()&&(u=u.slice(),u.reverse()),console.log("# items to render:"+u.length),u}function B(u){e.onUpdateValue&&e.onUpdateValue(u)}function Y(u){return n()==="disabled"?!1:(u!==a(b)&&(T=!0),B(u),!0)}function se(u,E){return t().getData(u,E)}var fe=G(()=>Ne("he-tree",o()&&"he-tree--rtl rtl",z)),Ce=G(()=>!r()),Ae=G(U),p=G(()=>{var u;return((u=t().nodeInfos)==null?void 0:u.length)||0});Fe(dt(i,{get class(){return a(fe)},get style(){return v()},height:500,get isDisabled(){return a(Ce)},width:"auto",get model(){return a(Ae)},get modelCount(){return a(p)},itemSize:25,vl_slot:(E,Q)=>{let F=()=>Q==null?void 0:Q().item;var c=j(),f=L(c);J(f,F,P=>{var Z=G(()=>Ne(F().class,{"drag-placeholder-wrapper":F().data===N,"dragging-node":F()===w}));ut(P,{get class(){return a(Z)},get style(){return F().style},get nodeInfo(){return F()},get rtl(){return o()},get btt(){return d()},get indent(){return l()},get treeLine(){return m()},get treeLineOffset(){return _()},get processor(){return t()},onNodeOpened:M=>{var x;return(x=e.onNodeOpened)==null?void 0:x.call(e,M)},onNodeClosed:M=>{var x;return(x=e.onNodeClosed)==null?void 0:x.call(e,M)},onNodeSelected:M=>{var x;return(x=e.onNodeSelected)==null?void 0:x.call(e,M)},onNodeChecked:M=>{var x;return(x=e.onNodeChecked)==null?void 0:x.call(e,M)},tn_slot:(M,x=$e)=>{var V=j(),Qe=L(V);J(Qe,()=>x().data===N,Pe=>{var le=Tt(),ke=te(le);J(ke,()=>e.placeholder,Ze=>{var Me=j(),qe=L(Me);ie(qe,()=>e.placeholder),C(Ze,Me)}),ne(le),C(Pe,le)},Pe=>{var le=j(),ke=L(le);ie(ke,()=>e.tree_slot,x),C(Pe,le)}),C(M,V)},$$slots:{tn_slot:!0}})}),C(E,c)},$$slots:{vl_slot:!0}}),E=>O=E,()=>O),be()}var Ct=W('<div class="item svelte-1s0qzrn"><!></div>'),_t=W('<section class="svelte-1s0qzrn"><!></section>'),Ot=W("<b> </b> <!>",1);function je(i,e){Oe(e,!0);let t=g(e,"tree",15),n=g(e,"node",7);const s=300;function l(v){n().children=v.detail.items}function r(v){n().children=v.detail.items,t({...t()})}var o=Ot(),d=L(o),m=te(d);ne(d);var _=he(d,2);J(_,()=>{var v;return(v=n())==null?void 0:v.children},v=>{var h=_t(),O=te(h);J(O,()=>n().children,K=>{var y=j(),w=L(y);_e(w,25,()=>n().children,z=>z.id,(z,N)=>{var R=Ct(),T=te(R);je(T,{get tree(){return t()},set tree(b){t(b)},get node(){return t()[a(N).id]}}),ne(R),tt(R,()=>it,()=>({duration:s})),C(z,R)}),C(K,y)}),ne(h),Ke("consider",h,l),Ke("finalize",h,r),nt(h,(K,y)=>st(K,y),()=>({items:n().children||[],flipDurationMs:s,centreDraggedOnCursor:!0})),C(v,h)}),oe(()=>{var v,h;ce(d,"style",`color:${((v=n())==null?void 0:v.color)??""}`),et(m,(h=n())==null?void 0:h.name)}),C(i,o),be()}var bt=W("<h3>Try dragging node2 into node3 and then node4 into node2</h3> <!>",1);function wt(i){let e=D(S({node1:{name:"node 1",children:[{id:"node2"},{id:"node3"},{id:"node4"}],id:"node1"},node2:{name:"node 2",children:[{id:"node5"},{id:"node6"},{id:"node7"},{id:"node8"}],id:"node2"},node3:{name:"node 3",children:[{id:"node9"},{id:"node10"},{id:"node11"},{id:"node12"}],id:"node3"},node4:{name:"node 4",children:[{id:"node13"},{id:"node14"},{id:"node15"},{id:"node16"}],id:"node4",color:"salmon"}}));for(let s=5;s<17;(s+=1)-1)a(e)[`node${s}`]={id:`node${s}`,name:`item ${s}`};a(e).node10.color="steelblue",a(e).node11.color="steelblue",a(e).node14.color="orange",a(e).node15.color="orange",a(e).node6.color="forestgreen";var t=bt(),n=he(L(t),2);je(n,{get node(){return a(e).node1},get tree(){return a(e)},set tree(s){A(e,S(s))}}),C(i,t)}export{wt as A,kt as T};
