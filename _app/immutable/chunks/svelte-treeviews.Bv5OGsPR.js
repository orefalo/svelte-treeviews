var st=Object.defineProperty;var Ke=r=>{throw TypeError(r)};var dt=(r,e,t)=>e in r?st(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var y=(r,e,t)=>dt(r,typeof e!="symbol"?e+"":e,t),lt=(r,e,t)=>e.has(r)||Ke("Cannot "+t);var x=(r,e,t)=>(lt(r,e,"read from private field"),t?t.call(r):e.get(r)),A=(r,e,t)=>e.has(r)?Ke("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t);import{d as ot,p as m,t as B,a as N,b as R,s as me,c as at,r as ct,e as ht,g as h,f as z,h as xe,u as ge,i as q,j as J,k as V,l as Ae,m as ft,n as le,o as ve,q as G,v as be,w as se,x as _e,y as P,z as K,A as b,B as ut,V as gt,C as de,D as Te,E as vt,F as _t,G as Re,H as It,I as yt,J as mt}from"./external.DE7A-Ldg.js";var xt=R('<a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="svelte-1t1owd"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42Z"></path></svg></a>');function qt(r,e){let t=m(e,"open",11,!1),n=m(e,"class",3,""),s=m(e,"onclick",3,()=>{});var i=xt();i.__click=function(...a){var l;(l=s())==null||l.apply(this,a)},B(()=>{me(i,`${`treeicon ${n()}`??""} svelte-1t1owd`),at(i,"open",t())}),N(r,i)}ot(["click"]);var bt=R('<input type="checkbox">');function Gt(r,e){let t=m(e,"value",15),n=z(()=>t()===0);var s=bt();ct(s),B(()=>{me(s,e.class),s.indeterminate=h(n)}),ht(s,t),N(r,s)}var kt=R('<div class="tree-line tree-vline svelte-gfld7i"></div>'),wt=R('<div class="tree-line tree-hline svelte-gfld7i"></div>'),Nt=R("<!> <!>",1),Ct=R('<div><!> <div class="tree-node-inner"><!></div></div>');function Ot(r,e){xe(e,!0);let t=z(()=>e.style?`${e.style};${e.rtl?"padding-right":"padding-left"}:${e.indent*(e.nodeInfo.level-1)}px`:`${e.rtl?"padding-right":"padding-left"}:${e.indent*(e.nodeInfo.level-1)}px`),n=z(()=>`${e.rtl?"right":"left"}:${(e.nodeInfo.level-2)*e.indent+e.treeLineOffset}px`);ge(()=>{var u,f;e.nodeInfo.checked,(u=e.processor)!=null&&u.afterOneCheckChanged(e.nodeInfo)&&((f=e.onNodeChecked)==null||f.call(e,e.nodeInfo))}),ge(()=>{var f,v;e.nodeInfo.expended?(f=e.onNodeOpened)==null||f.call(e,e.nodeInfo):(v=e.onNodeClosed)==null||v.call(e,e.nodeInfo)});const s=z(()=>{const u=[],f=I=>{var C;if(I.parent){let O=(C=I.parent)==null?void 0:C.children.indexOf(I);do{O+=1;const M=I.parent.children[O];if(M){if(!M.hidden)return!0}else break}while(!0)}return!1},v=e.rtl?"right":"left",S=e.btt?"top":"bottom";let o=e.nodeInfo;for(;o;){const I=(o.level-2)*e.indent+e.treeLineOffset,C=f(o),O=()=>{u.push({style:`${v}:${I}px;${S}:${C?"0":"50%"}`})};o===e.nodeInfo?o.level>1&&O():C&&O(),o=o.parent}return u});var i=Ct();const a=z(()=>`${_e("tree-node",e.class,e.treeLine&&"tree-node--with-tree-line")??""} svelte-gfld7i`);var l=q(i);J(l,()=>e.treeLine,u=>{var f=Nt(),v=V(f);Ae(v,17,()=>h(s),ft,(o,I)=>{var C=kt();B(()=>se(C,"style",h(I).style)),N(o,C)});var S=le(v,2);J(S,()=>e.nodeInfo.level>1,o=>{var I=wt();B(()=>se(I,"style",h(n))),N(o,I)}),N(u,f)});var c=le(l,2),_=q(c);ve(_,()=>e.tn_slot,()=>({data:e.nodeInfo.data,info:e.nodeInfo})),G(c),G(i),B(()=>{me(i,h(a)),se(i,"style",h(t))}),N(r,i),be()}function Ie(r){return Object.prototype.toString.call(r)==="[object Array]"}function Pt(r){return r[r.length-1]}function ze(r,e){let t,n=0;for(;(t=r.indexOf(e))>-1;)r.splice(t,1),n++;return n}function Kt(r,e,t){r.hasOwnProperty(e)||(r[e]=t)}function Tt(r,e){return Object.keys(e).forEach(t=>{Kt(r,t,e[t])}),r}function Rt(r){const e={};return Object.keys(r).forEach(t=>{r[t]!==void 0&&(e[t]=r[t])}),e}function H(r,e,t={}){t=Tt({...t},{childrenKey:"children"});const n=t.childrenKey,s=Ie(r)?r:[r];class i{}const a=(l,c,_)=>{t.reverse&&(l=l.slice(),l.reverse());const u=l.length;for(let f=0;f<u;f++){const v=l[f],S=t.reverse?u-f-1:f,o=_?[..._,S]:[];t.childFirst&&v[n]!=null&&a(v[n],v,o);const I=e(v,S,c,o);if(I===!1)throw new i;if(I==="skip children")continue;if(I==="skip siblings")break;t.childFirst||v[n]!=null&&a(v[n],v,o)}};try{a(s,null,Ie(r)?[]:null)}catch(l){if(!(l instanceof i))throw l}}function St(r,e){const t={childrenKey:"children"};e&&Object.assign(t,e);const n=t.childrenKey,s=t.nodeHandler,i=new ye;return i.childrenKey=n,H(r,(a,l,c,_)=>{let u=Object.assign({},a);u[n]&&(u[n]=[]),s&&(u=s(u,{oldNode:a,index:l,parent:c,path:_})),i.set(_,u)},{childrenKey:n}),i.data}class ye{constructor(e=[]){y(this,"data");y(this,"childrenKey","children");this.data=e}get rootChildren(){const{childrenKey:e}=this,{data:t}=this;return Ie(t)?t:t[e]}*iteratePath(e,t={}){const{childrenKey:n,rootChildren:s}=this;if(t.reverse){const i=[...this.iteratePath(e,{...t,reverse:!1})];i.reverse();for(const{path:a,node:l}of i)yield{path:a,node:l}}else{let i=[],a=s;for(const l of e){const c=[...i,l],_=a[l];yield{path:c,node:_},i=c,a=_[n]}}}getFamily(e){const t=[];for(const{node:n}of this.iteratePath(e))t.push(n);return t}get(e){return Pt(this.getFamily(e))}getParentAndIndex(e){const t=e.slice(),n=t.pop();return{parent:this.get(t),index:n,parentPath:t}}getParent(e){return this.getParentAndIndex(e).parent}set(e,t){if(e===null||e.length===0)this.data=t;else{const{childrenKey:n}=this;let{rootChildren:s}=this;const{parent:i,index:a}=this.getParentAndIndex(e);let l;e.length===1?(s||(this.data?this.data[n]=[]:this.data=[]),l=s):(i[n]||(i[n]=[]),l=i[n]),l[a]=t}}delete(e){const{childrenKey:t,rootChildren:n}=this,{parent:s,index:i}=this.getParentAndIndex(e),a=e.length===1?n:s[t],l=a[i];return a.splice(i,1),l}walk(e,t){const{childrenKey:n,data:s}=this;return H(s,e,n)}clone(e={}){return St(this.data),Rt({childrenKey:this.childrenKey,nodeHandler:e.nodeHandler||void 0})}}var j,Q,X,Y,p,$;class Z{constructor(e){y(this,"data");A(this,j,P(!1));y(this,"parent");A(this,Q,P(b([])));y(this,"level",0);A(this,X,P(!1));A(this,Y,P(!1));y(this,"draggable");y(this,"droppable");A(this,p,P(""));A(this,$,P(""));this.data=(e==null?void 0:e.data)||null,this.expended=(e==null?void 0:e.expended)||!1,this.parent=e==null?void 0:e.parent,this.children=(e==null?void 0:e.children)||[],this.level=(e==null?void 0:e.level)||0,this.hidden=(e==null?void 0:e.hidden)||!1,this.checked=(e==null?void 0:e.checked)||!1,this.draggable=e==null?void 0:e.draggable,this.droppable=e==null?void 0:e.droppable,this.style=e==null?void 0:e.style,this.class=e==null?void 0:e.class}get expended(){return h(x(this,j))}set expended(e){K(x(this,j),b(e))}get children(){return h(x(this,Q))}set children(e){K(x(this,Q),b(e))}get hidden(){return h(x(this,X))}set hidden(e){K(x(this,X),b(e))}get checked(){return h(x(this,Y))}set checked(e){K(x(this,Y),b(e))}get style(){return h(x(this,p))}set style(e){K(x(this,p),b(e))}get class(){return h(x(this,$))}set class(e){K(x(this,$),b(e))}toggleExpand(){this.expended=!this.expended}toggleChecked(){this.checked=!this.checked}}j=new WeakMap,Q=new WeakMap,X=new WeakMap,Y=new WeakMap,p=new WeakMap,$=new WeakMap;const F="children";class Le{constructor(e){y(this,"childrenKey",F);y(this,"defaultOpen",!1);y(this,"noInitialization",!1);this.childrenKey=(e==null?void 0:e.childrenKey)||F,this.defaultOpen=(e==null?void 0:e.defaultOpen)||!1,this.noInitialization=(e==null?void 0:e.noInitialization)||!1}}var ee,te,ne;class At{constructor(e,t){y(this,"rawData");A(this,ee,P(b([])));A(this,te,P(b([])));A(this,ne,P(b(new Map)));y(this,"options");y(this,"afterSetInfoNode");y(this,"afterRemoveInfoNode");y(this,"infoNodesHandler");y(this,"infoNodesFlatHandler");y(this,"infoHandler",e=>e);y(this,"initialized",!1);this.options=t||new Le}get nodeInfos(){return h(x(this,ee))}set nodeInfos(e){K(x(this,ee),b(e))}get nodeInfosToRender(){return h(x(this,te))}set nodeInfosToRender(e){K(x(this,te),b(e))}get _infosMap(){return h(x(this,ne))}set _infosMap(e){K(x(this,ne),b(e))}init(){if(!this.initialized){this.initialized=!0,console.log("TreeProcessor.init() called");const e=this.options.childrenKey,t=new ye([]);this._infosMap.clear(),H(this.rawData,(s,i,a,l)=>{const c=this.infoHandler(new Z({data:s,expended:this.options.defaultOpen,parent:t.getParent(l),children:[],level:l.length}));this._infosMap.set(s,c),t.set(l,c)},{childrenKey:e});const n=[];t.walk(s=>{n.push(s)}),this.nodeInfos=this.infoNodesHandler?this.infoNodesHandler(t.rootChildren):t.rootChildren,this.nodeInfosToRender=this.infoNodesFlatHandler?this.infoNodesFlatHandler(n):n}}getNodeInfo(e){const t=this._infosMap.get(e);if(!t)throw new Se("NodeInfo not found");return t}has(e){if(e instanceof Z)return this.nodeInfosToRender.indexOf(e)>-1;try{return(!!this.getNodeInfo(e)).valueOf()}catch(t){if(t instanceof Se)return!1;throw t}}_getPathByStat(e){if(e===null)return[];const n=this.getSiblings(e).indexOf(e);return[...e.parent?this._getPathByStat(e.parent):[],n]}afterOneCheckChanged(e){const{checked:t}=e,n=s=>{const i=s.parent;if(i){let a=!1,l=!1,c=!1;for(const u of i.children)u.checked?a=!0:u.checked===0?c=!0:l=!0;const _=c?0:l?a?0:!1:!0;i.checked!==_&&(i.checked=_),n(i)}};return n(e),H(e.children,s=>{s.checked!==t&&(s.checked=t)},{childrenKey:F}),!0}isVisible(e){const t=e instanceof Z?e:this.getNodeInfo(e),n=s=>!s||!s.hidden&&s.expended&&n(s.parent);return!t.hidden&&n(t.parent)}updateCheckboxes(){H(this.nodeInfos,e=>{if(e.children&&e.children.length>0){const t=e.children.every(n=>n.checked);e.checked!==t&&(e.checked=t)}},{childFirst:!0,childrenKey:F})}getChecked(e=!1){return this.nodeInfosToRender.filter(t=>t.checked||e&&t.checked===0)}getUnchecked(e=!0){return this.nodeInfosToRender.filter(t=>e?!t.checked:t.checked===!1)}openAll(){for(const e of this.nodeInfosToRender)e.expended=!0}closeAll(){for(const e of this.nodeInfosToRender)e.expended=!1}openNodeAndParents(e){const t=e instanceof Z?e:this.getNodeInfo(e);for(const n of this.iterateParent(t,{withSelf:!0}))n.expended=!0}_calcFlatIndex(e,t){let n=e?this.nodeInfosToRender.indexOf(e)+1:0;const s=e?e.children:this.nodeInfos;for(let i=0;i<t;(i+=1)-1)n+=this._count(s[i]);return n}add(e,t,n){if(this.has(e))throw"Can't add because data exists in tree";const s=t?t.children:this.nodeInfos;n==null&&(n=s.length);const i=this.infoHandler(new Z({expended:!!this.options.defaultOpen,data:e,parent:t||void 0,children:[],level:t?t.level+1:1}));this._setPosition(i,t||void 0,n);const a=e[this.childrenKey];if(a){const l=a.slice();for(const c of l)this.add(c,i)}}remove(e){var n;const t=this.getSiblings(e);if(t.includes(e)){ze(t,e);const s=this._flat(e);this.nodeInfosToRender.splice(this.nodeInfosToRender.indexOf(e),s.length);for(const i of s)this._infosMap.delete(i.data);return(n=this.afterRemoveInfoNode)==null||n.call(this,e),!0}return!1}getSiblings(e){const{parent:t}=e;return t?t.children:this.nodeInfos}_setPosition(e,t,n){var l;(t?t.children:this.nodeInfos).splice(n,0,e),e.parent=t,e.level=t?t.level+1:1;const i=this._calcFlatIndex(t,n),a=this._flat(e);this.nodeInfosToRender.splice(i,0,...a);for(const c of a)this._infosMap.has(c.data)||this._infosMap.set(c.data,c);H(e,(c,_,u)=>{u&&(c.level=u.level+1)},{childrenKey:F}),(l=this.afterSetInfoNode)==null||l.call(this,e,t,n)}*iterateParent(e,t){let n=t!=null&&t.withSelf?e:e.parent;for(;n;)yield n,n=n.parent}move(e,t,n){if(this.has(e)){if(e.parent===t&&this.getSiblings(e).indexOf(e)===n)return!1;if(e===t)throw new Error("Can't move node to itself");if(t&&e.level<t.level){let s;for(const i of this.iterateParent(t))if(i.level===e.level){s=i;break}if(e===s)throw new Error("Can't move node to its descendant")}this.remove(e)}return this._setPosition(e,t,n),!0}_flat(e){const t=[];return H(e,n=>{t.push(n)},{childrenKey:F}),t}_count(e){return this._flat(e).length}getData(e,t){const{childrenKey:n}=this.options,s=new ye([]);return s.childrenKey=n,H(t||this.nodeInfos,(i,a,l,c)=>{let _={...i.data,[n]:[]};e&&(_=e(_)),s.set(c,_)},{childrenKey:F}),s.data}}ee=new WeakMap,te=new WeakMap,ne=new WeakMap;class Se extends Error{constructor(e){super(e),this.name="StatNotFoundError"}}class zt extends Le{constructor(t){super(t);y(this,"preProcessor")}filter(t,n){return t?t(n):n}}function Lt(r,e){const t=new zt(e),n=new At(r,t);return t.noInitialization||n.init(),n}var Ht=R('<div class="drag-placeholder he-tree-drag-placeholder"><!></div>');function Jt(r,e){xe(e,!0);let t=m(e,"updateBehavior",3,"modify"),n=m(e,"childrenKey",3,F),s=m(e,"indent",15,20),i=m(e,"virtualization",11,!1),a=m(e,"virtualizationPrerenderCount",3,20),l=m(e,"defaultOpen",11,!0),c=m(e,"rtl",15,!1),_=m(e,"btt",15,!1),u=m(e,"treeLine",15,!1),f=m(e,"treeLineOffset",7,8),v=m(e,"class",3,""),S=m(e,"style",3,"");m(e,"selectionBehavior",3,"single");let o=m(e,"processor",23,()=>Lt([],{noInitialization:!0,defaultOpen:l()}));const I=d=>d?(d[n()]||(d[n()]=[]),d[n()]):h(W);o().afterSetInfoNode=(d,g,k)=>{let w=h(W);if(t()==="new"){if(L)return;w=re()}else if(t()==="modify"){const E=I(g==null?void 0:g.data);E.includes(d.data)||E.splice(k,0,d.data)}else t();L||ce(w)},o().afterRemoveInfoNode=d=>{var k;let g=h(W);if(t()==="new"){if(L)return;g=re()}else if(t()==="modify"){const w=I((k=d.parent)==null?void 0:k.data);ze(w,d.data)}else t();L||ce(g)};let C,O=P(b([])),M=P(b([])),D=null,oe=!1,ie={},L=!1,ae=!1,W=z(()=>e.model);ge(()=>{console.log("model change detected"),ae?ae=!1:(console.log("Initializing model"),o().rawData=e.model,o().init(),K(O,b(o().nodeInfos)),K(M,b(o().nodeInfosToRender)))});function Fe(d){}function Me(){let d=h(M);return _()&&(d=d.slice().reverse()),d.filter(g=>we(g))}function Ee(){return h(O)}function Ve(d){e.onUpdateValue&&e.onUpdateValue(d)}function ce(d){return t()==="disabled"?!1:(d!==h(W)&&(ae=!0),Ve(d),!0)}function ke(d){return o().getNodeInfo(d)}function De(d){return o().has(d)}function Ue(d){return o().getChecked(d)}function Be(d){return o().getUnchecked(d)}function qe(){console.log("openAll"),o().openAll()}function Ge(d){o().openNodeAndParents(d)}function Je(){console.log("closeAll"),o().closeAll()}function we(d){return o().isVisible(d)}function We(d,g,k){return o().move(d,g,k)}function Ne(d,g,k){return o().add(d,g,k)}function Ze(d,g,k){he(()=>{let w=k;for(const E of d)Ne(E,g,w),w!=null&&(w+=1)})}function Ce(d){return o().remove(d)}function je(d){const g=[...d];he(()=>{for(const k of g)Ce(ke(k))})}function Qe(d,g){return o().iterateParent(d,g)}function Xe(d){return o().getSiblings(d)}function re(d,g){return o().getData(d,g)}function he(d){const g=Ye(d);return L||ce(t()==="new"?re():h(W)),g}function Ye(d){const g=L;L=!0;const k=d();return L=g,k}var pe=z(()=>_e("he-tree",v(),c()&&"he-tree--rtl rtl",oe)),$e=z(()=>!i()),et=z(Me);return ut(gt(r,{get class(){return h(pe)},get style(){return S()},get preRenderCount(){return a()},get isDisabled(){return h($e)},get items(){return h(et)},vl_slot:(g,k)=>{let w=()=>k==null?void 0:k().item;var E=de(),tt=V(E);J(tt,w,nt=>{var it=z(()=>_e(w().class,{"drag-placeholder-wrapper":w().data===ie,"dragging-node":w()===D}));Ot(nt,{get class(){return h(it)},get style(){return w().style},get nodeInfo(){return w()},get rtl(){return c()},set rtl(T){c(T)},get btt(){return _()},set btt(T){_(T)},get indent(){return s()},set indent(T){s(T)},get treeLine(){return u()},set treeLine(T){u(T)},get treeLineOffset(){return f()},set treeLineOffset(T){f(T)},get processor(){return o()},get onNodeOpened(){return e.onNodeOpened},get onNodeClosed(){return e.onNodeClosed},onNodeChecked:Fe,tn_slot:(T,Oe=Te)=>{var Pe=de(),rt=V(Pe);J(rt,()=>Oe().data===ie,fe=>{var U=Ht(),ue=q(U);ve(ue,()=>e.placeholder??Te),G(U),N(fe,U)},fe=>{var U=de(),ue=V(U);ve(ue,()=>e.tree_slot,Oe),N(fe,U)}),N(T,Pe)},$$slots:{tn_slot:!0}})}),N(g,E)},$$slots:{vl_slot:!0}}),g=>C=g,()=>C),be({rootChildren:Ee,getNodeInfo:ke,has:De,getChecked:Ue,getUnchecked:Be,openAll:qe,openNodeAndParents:Ge,closeAll:Je,isVisible:we,move:We,add:Ne,addMulti:Ze,remove:Ce,removeMulti:je,iterateParent:Qe,getSiblings:Xe,getData:re,batchUpdate:he})}var Ft=R('<div class="item svelte-1s0qzrn"><!></div>'),Mt=R('<section class="svelte-1s0qzrn"><!></section>'),Et=R("<b> </b> <!>",1);function He(r,e){xe(e,!0);let t=m(e,"tree",15),n=m(e,"node",7);const s=300;function i(f){n().children=f.detail.items}function a(f){n().children=f.detail.items,t({...t()})}var l=Et(),c=V(l),_=q(c,!0);G(c);var u=le(c,2);J(u,()=>{var f;return(f=n())==null?void 0:f.children},f=>{var v=Mt(),S=q(v);J(S,()=>n().children,o=>{var I=de(),C=V(I);Ae(C,25,()=>n().children,O=>O.id,(O,M)=>{var D=Ft(),oe=q(D);He(oe,{get tree(){return t()},set tree(ie){t(ie)},get node(){return t()[h(M).id]}}),G(D),vt(D,()=>It,()=>({duration:s})),N(O,D)}),N(o,I)}),G(v),_t(v,(o,I)=>yt(o,I),()=>({items:n().children||[],flipDurationMs:s,centreDraggedOnCursor:!0})),Re("consider",v,i),Re("finalize",v,a),N(f,v)}),B(()=>{var f,v;se(c,"style",`color:${((f=n())==null?void 0:f.color)??""}`),mt(_,(v=n())==null?void 0:v.name)}),N(r,l),be()}var Vt=R("<h3>Try dragging node2 into node3 and then node4 into node2</h3> <!>",1);function Wt(r){let e=P(b({node1:{name:"node 1",children:[{id:"node2"},{id:"node3"},{id:"node4"}],id:"node1"},node2:{name:"node 2",children:[{id:"node5"},{id:"node6"},{id:"node7"},{id:"node8"}],id:"node2"},node3:{name:"node 3",children:[{id:"node9"},{id:"node10"},{id:"node11"},{id:"node12"}],id:"node3"},node4:{name:"node 4",children:[{id:"node13"},{id:"node14"},{id:"node15"},{id:"node16"}],id:"node4",color:"salmon"}}));function t(){for(let i=5;i<17;(i+=1)-1)h(e)[`node${i}`]={id:`node${i}`,name:`item ${i}`};h(e).node10.color="steelblue",h(e).node11.color="steelblue",h(e).node14.color="orange",h(e).node15.color="orange",h(e).node6.color="forestgreen"}t();var n=Vt(),s=le(V(n),2);He(s,{get node(){return h(e).node1},get tree(){return h(e)},set tree(i){K(e,b(i))}}),N(r,n)}export{Wt as A,Gt as I,qt as O,Jt as T};
